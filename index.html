<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fatehpur Hubs</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff6666">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <style>
        /* Basic Styling (Unchanged) */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
        body { background: #f5f5f5; }
        /* CRITICAL FIX: Main content ko 100px padding-bottom de rahe hain (Footer 48px + Ad 50px) */
        .container { 
            max-width: 400px; 
            margin: 0 auto; 
            background: white; 
            min-height: 100vh;
            /* Yahan padding-bottom joD rahe hain taaki content neeche fixed bars ke peeche na chhipe */
            padding-bottom: 100px; 
        } 
        header { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 15px; text-align: center; }
        .screen { display: none; padding: 15px; }
        .screen.active { display: block; }
        #main-search-bar { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 25px; margin: 10px 0 20px; }
        .categories-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .cat-btn { background: white; border: 2px solid #e0e0e0; padding: 12px 8px; border-radius: 10px; cursor: pointer; text-align: center; font-size: 14px; transition: all 0.3s; }
        .cat-btn.selected { background: #2a5298; color: white; border-color: #2a5298; }
        .profile-card { background: white; border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .contact-btn, .whatsapp-btn, .share-btn-inline { padding: 8px 15px; border-radius: 20px; cursor: pointer; margin: 5px; }
        .contact-btn { background: #2a5298; color: white; border: none; }
        .whatsapp-btn { background: #25D366; color: white; border: none; }
        .share-btn-inline { background: #f8f9fa; color: #333; border: 1px solid #e0e0e0; }
        
        /* ‚≠ê CRITICAL FIX 1: Footer ko Ad Unit (50px) jitna upar shift kiya gaya hai ‚≠ê */
        .footer { 
            position: fixed; 
            bottom: 50px; /* ORIGINAL THA: bottom: 0; */
            width: 100%; 
            max-width: 400px; 
            background: white; 
            padding: 10px 15px; 
            display: flex; 
            justify-content: space-between; 
            border-top: 1px solid #e0e0e0; 
            z-index: 1000; /* Z-index badhaya takki Ad Unit se upar dikhe */
        }
        .premium-btn { background: #ffd700; color: #333; padding: 8px 15px; border-radius: 20px; text-decoration: none; font-weight: bold; }
        .ad-container { margin: 15px 0; text-align: center; background: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px solid #e0e0e0; }
        .promotion-banner { background: linear-gradient(135deg, #ff6b6b, #feca57); color: white; padding: 15px; border-radius: 12px; text-align: center; margin: 20px 0; font-weight: bold; }
        /* Registration Specific Styles */
        .reg-input { width:100%; padding:15px; margin:10px 0; border-radius:10px; border:1px solid #ddd; font-size:16px; }
        
        /* ‚≠ê CRITICAL FIX 2: Bottom Ad Unit ki positioning aur Z-Index ‚≠ê */
        #bottom-ad {
            position: fixed;
            bottom: 0;
            z-index: 999; /* Footer se kam rakha hai */
            width: 100%;
            max-width: 400px; /* Container ki width se match kare */
            height: 50px; /* 320x50 ad size ke liye */
            display: flex; /* Centering ke liye */
            justify-content: center;
            align-items: center;
            background: #f5f5f5; /* Taki ad load hone se pehle white na dikhe */
        }
        /* Load More Button Styling */
        .load-more-btn {
            width: 100%;
            padding: 12px;
            background: #2a5298;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            margin: 15px 0;
            cursor: pointer;
            transition: background 0.3s;
        }
        .load-more-btn:hover {
            background: #1e3c72;
        }
    </style>
</head>
<body>

    <div class="ad-container">
        <!-- Ad Script 1 -->
        <script type="text/javascript">
            atOptions = { 'key' : '969a80a2e6bea9f00173f36024f32cb2', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
            document.write('<script type="text/javascript" src="//www.highperformanceformat.com/969a80a2e6bea9f00173f36024f32cb2/invoke.js"><\/script>');
        </script>
    </div>

    <!-- ‚≠ê UPDATED REGISTRATION/LOGIN SCREEN ‚≠ê -->
    <div id="registrationScreen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#1e3c72,#2a5298);display:flex;align-items:center;justify-content:center;z-index:9999;">
        <div style="background:white;padding:30px;border-radius:20px;text-align:center;width:90%;max-width:400px;box-shadow:0 10px 30px rgba(0,0,0,0.5);">
            <h2 style="color:#1e3c72; margin-bottom: 20px;">Fatehpur Hubs</h2>
            
            <div id="profileInputSection">
                <p style="color:#555;margin:15px 0;">Sign Up/Login ‡§ï‡§∞‡•á‡§Ç</p>
                <input type="text" id="userName" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ" class="reg-input">
                <input type="text" id="userArea" placeholder="‡§Ü‡§™‡§ï‡•Ä ‡§≤‡•ã‡§ï‡•à‡§≤‡§ø‡§ü‡•Ä/Area" class="reg-input">
                <input type="tel" id="phoneInput" placeholder="10 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ Mobile Number" maxlength="10" class="reg-input">
                <button id="sendOtpBtn" style="width:100%;padding:15px;background:#25D366;color:white;border:none;border-radius:10px;font-size:16px;cursor:pointer;margin-top:15px;">Send OTP & Sign Up</button>
            </div>

            <div id="otpSection" style="margin-top:20px;display:none;">
                <p style="color:#555;margin:15px 0;">OTP Verify ‡§ï‡§∞‡•á‡§Ç</p>
                <input type="text" id="otpInput" placeholder="6 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ OTP" maxlength="6" class="reg-input">
                <button id="verifyOtpBtn" style="width:100%;padding:15px;background:#ff9800;color:white;border:none;border-radius:10px;font-size:16px;cursor:pointer;">Verify OTP</button>
                <button onclick="document.getElementById('otpSection').style.display='none'; document.getElementById('profileInputSection').style.display='block'; document.getElementById('sendOtpBtn').innerHTML='Send OTP & Sign Up';" style="background:none; border:none; color:#1e3c72; margin-top:10px; cursor:pointer;">&#8592; Edit Number</button>
            </div>
            
            <p id="loginMsg" style="margin-top:15px;color:red;font-size:14px;min-height:20px;"></p>
            <div id="recaptcha-container"></div>
        </div>
    </div>
    <!-- ‚≠ê END OF REGISTRATION/LOGIN SCREEN ‚≠ê -->


    <div class="container" id="mainApp" style="display:none;">
        <header><h1><img src="file_0000000059806208b25eb7951e979b96.png" alt="Logo" style="height:50px;"> Fatehpur Hubs</h1></header>

        <div id="home-screen" class="screen active">
            <input type="text" id="main-search-bar" placeholder="Search Plumber, Electrician..." onkeyup="searchServices()">

            <div class="promotion-banner">
                <p>Apna Business Promote Karein! ‚Çπ500/month se shuru<br>
                <button onclick="contactForAds()" style="background:white;color:#d35400;padding:8px 20px;border:none;border-radius:25px;margin-top:10px;font-weight:bold;">Ad Lagwayein</button></p>
            </div>

            <div class="ad-container">
                <!-- Ad Script 2 -->
                <script type="text/javascript">
                    atOptions = { 'key' : 'd65603602583bbe6bc3308e8ee8ab792', 'format' : 'iframe', 'height' : 250, 'width' : 300, 'params' : {} };
                    document.write('<script type="text/javascript" src="//www.highperformanceformat.com/d65603602583bbe6bc3308e8ee8ab792/invoke.js"><\/script>');
                </script>
            </div>

            <div class="promotion-section" style="margin:20px 0;padding:20px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2);overflow:hidden;">
                <h3 style="text-align:center;color:white;font-size:18px;margin:0 0 15px;font-weight:bold;">
                    Special Offers & Promotions
                </h3>
                <div id="promotion-banner-area" style="position:relative;border-radius:12px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,0.3);">
                    <p style="text-align:center;color:#fff;padding:20px;font-size:14px;">Loading amazing offers...</p>
                </div>
                <div style="text-align:center;margin-top:15px;">
                    <button onclick="contactForAds()" style="background:#fff;color:#764ba2;padding:10px 25px;border:none;border-radius:30px;font-weight:bold;box-shadow:0 5px 15px rgba(0,0,0,0.2);">
                        Apna Ad Lagwayein (‚Çπ500/month)
                    </button>
                </div>
            </div>

            <h3>Popular Services</h3>
            <div class="categories-list" id="mistri-categories"></div>
            <div id="service-registration" style="margin:20px 0;padding:20px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:10px;color:white;">
                <h3 style="text-align:center;">Add Your Service</h3>
                <form id="serviceForm" onsubmit="event.preventDefault(); return registerService();">
                    <input type="text" id="providerName" placeholder="Your Name" required style="width:100%;padding:12px;margin:8px 0;border:none;border-radius:8px;">
                    <input type="tel" id="providerPhone" placeholder="Phone Number" required style="width:100%;padding:12px;margin:8px 0;border:none;border-radius:8px;">
                    <select id="serviceCategory" required style="width:100%;padding:12px;margin:8px 0;border:none;border-radius:8px;">
                        <option value="">Select Service</option>
                        <option>Plumber</option><option>Electrician</option><option>Carpenter</option><option>Mason</option>
                        <option>Painter</option><option>AC Mechanic</option><option>Tiler</option><option>Beautician</option>
                        <option>Home Cleaning</option><option>Security Guard</option><option>Laundry Service</option>
                        <option>Legal Consultant</option><option>Private Teacher</option><option>Computer Repair</option><option>Welder</option>
                    </select>
                    <input type="text" id="providerArea" placeholder="Your Area" required style="width:100%;padding:12px;margin:8px 0;border:none;border-radius:8px;">
                    <input type="text" id="providerExperience" placeholder="Experience (years)" required style="width:100%;padding:12px;margin:8px 0;border:none;border-radius:8px;">
                    <button type="submit" style="width:100%;background:#25D366;color:white;padding:12px;border:none;border-radius:8px;font-weight:bold;">Register Service</button>
                </form>
            </div>

            <div id="mistri-list"><h3>Available Services</h3><p style="text-align:center;color:#2a5298;">Loading...</p></div>
            <!-- ‚≠ê New "Load More" Button for Services ‚≠ê -->
            <button id="load-more-providers" class="load-more-btn" onclick="loadCategories(true)" style="display:none;">Load More Services</button>
            <div style="height:80px;"></div>
        </div>
        
        <!-- Job Screen (Structure corrected as requested previously) -->
        <div id="jobs-screen" class="screen">
            <h2 class="screen-title">üíº Job Listings</h2>

            <!-- JOB REGISTRATION FORM -->
            <div class="registration-section" style="padding: 15px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 20px;">
                <h3>‚úÖ Job Post ‡§ï‡§∞‡•á‡§Ç (Hiring)</h3>
                <form id="jobForm" onsubmit="jobRegister(); return false;">
                    <input type="text" id="jobTitle" placeholder="‡§ú‡•â‡§¨ ‡§ü‡§æ‡§á‡§ü‡§≤ (‡§ú‡•à‡§∏‡•á: ‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡•à‡§® ‡§ö‡§æ‡§π‡§ø‡§è)" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <input type="text" id="jobShopName" placeholder="‡§¶‡•Å‡§ï‡§æ‡§®/‡§ï‡§Ç‡§™‡§®‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <input type="text" id="jobLocation" placeholder="‡§≤‡•ã‡§ï‡•á‡§∂‡§®/‡§™‡§§‡§æ" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <input type="number" id="jobSalary" placeholder="‡§∏‡•à‡§≤‡§∞‡•Ä (‡§ú‡•à‡§∏‡•á: 8000)" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <textarea id="jobDescription" placeholder="‡§ú‡•â‡§¨ ‡§µ‡§ø‡§µ‡§∞‡§£ (‡§ï‡§æ‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞‡§®‡§æ ‡§π‡•à?)" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                    <input type="number" id="jobPhone" placeholder="10 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ WhatsApp/‡§ï‡•â‡§≤ ‡§®‡§Ç‡§¨‡§∞" required maxlength="10" style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    
                    <button type="submit" class="contact-btn" style="width: 100%; background-color: #2a5298;">‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                </form>
            </div>
            <!-- END OF JOB REGISTRATION FORM -->
            
            <button onclick="showScreen('home-screen')" style="background:#f8f9fa;border:1px solid #ccc;padding:8px 15px;border-radius:5px;margin-bottom:15px;cursor:pointer;">Home Screen</button>
            <h2>Local Jobs</h2>
            <div id="jobs-list"><p>Loading jobs...</p></div>
            <!-- ‚≠ê New "Load More" Button for Jobs ‚≠ê -->
            <button id="load-more-jobs" class="load-more-btn" onclick="loadJobs(true)" style="display:none;">Load More Jobs</button>
        </div>

        <div class="footer">
            <a href="https://rzp.io/rzp/4kK9deS" target="_blank" class="premium-btn">Go Premium</a>
            <button class="share-btn-inline" onclick="shareApp()">Share App</button>
            <button class="share-btn-inline" onclick="showScreen('jobs-screen')">Jobs</button>
        </div>
    </div>

    <div id="bottom-ad">
        <!-- Ad Script 3 -->
        <script type="text/javascript">
            atOptions = { 'key' : '969a80a2e6bea9f00173f36024f32cb2', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
            document.write('<script type="text/javascript" src="//www.highperformanceformat.com/969a80a2e6bea9f00173f36024f32cb2/invoke.js"><\/script>');
        </script>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="ads.js"></script>
    <script src="script.js"></script>
    <script> 
            const firebaseConfig = {
        apiKey: "AIzaSyA37JsLUIG-kypZ55vdpLTp3WKHgRH2IwY",
        authDomain: "fatehpur-hubs-a3a9f.firebaseapp.com",
        databaseURL: "https://fatehpur-hubs-a3a9f-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "fatehpur-hubs-a3a9f",
        storageBucket: "fatehpur-hubs-a3a9f.appspot.com",
        messagingSenderId: "294360741451",
        appId: "1:294360741451:web:3bc85078805750b9fabfce"
    };

    let recaptchaVerifier, confirmationResult;
    let tempUserData = {}; 
    
    // ‚≠ê ‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§∏‡•ç‡§ü‡•á‡§ü ‡§´‡•â‡§∞ ‡§™‡•à‡§ú‡§ø‡§®‡•á‡§∂‡§® ‡§î‡§∞ ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞‡§ø‡§Ç‡§ó ‚≠ê
    const providersLimit = 20; 
    let providersLastTimestamp = null; 
    let providersLastKey = null; 
    let currentCategory = null; 
    
    // ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡•ã‡§ï‡§≤ ‡§ê‡§∞‡•á ‡§î‡§∞ ‡§™‡•á‡§ú ‡§á‡§Ç‡§°‡•á‡§ï‡•ç‡§∏ (Category Pagination Fix)
    let filteredProviders = [];
    let filteredPageIndex = 0;
    
    let jobsLastKey = null;
    const jobsLimit = 10;

    // ‡§∂‡•á‡§Ø‡§∞ ‡§°‡•Ä‡§ü‡•á‡§≤‡•ç‡§∏ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    window.shareProviderDetails = (name, phone, category) => {
        const shareText = `‡§®‡§æ‡§Æ: ${name} (${category})\n‡§´‡§º‡•ã‡§®: ${phone}\n\nFatehpur Hubs App ‡§ï‡•á ‡§ú‡§º‡§∞‡§ø‡§è ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§™‡•ç‡§∞‡•ã‡§µ‡§æ‡§á‡§°‡§∞ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§Æ‡§ø‡§≤‡•Ä‡•§`;
        if (navigator.share) {
            navigator.share({
                title: 'Service Provider Contact',
                text: shareText
            }).catch(error => console.error('Sharing failed', error));
        } else {
            // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
            const msg = document.createElement('div');
            msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            msg.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                    <h5 class="text-lg font-bold mb-3 text-gray-800">‡§ï‡•â‡§®‡•ç‡§ü‡•à‡§ï‡•ç‡§ü ‡§°‡•Ä‡§ü‡•á‡§≤‡•ç‡§∏</h5>
                    <p class="text-sm whitespace-pre-line text-gray-600">${shareText}</p>
                    <button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>`;
            document.body.appendChild(msg);
        }
    }

    // ‡§™‡•ç‡§∞‡•ã‡§µ‡§æ‡§á‡§°‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç
    function renderProviderCard(p) {
        return `<div class="profile-card">
            <h4 style="color:#2a5298;">${p.name} - (${p.category})</h4>
            <p style="font-size:12px;color:#555;">üìç ${p.area} | Experience: ${p.experience}</p>
            <div style="margin-top:10px; display: flex; justify-content: space-between; gap: 5px;">
                <button class="whatsapp-btn flex-1" onclick="openWhatsApp('${p.phone}')">WhatsApp</button>
                <button class="contact-btn flex-1" onclick="window.location.href='tel:${p.phone}'">Call Now</button>
                <button class="share-btn flex-1" onclick="shareProviderDetails('${p.name}', '${p.phone}', '${p.category}')">Share</button>
            </div>
        </div>`;
    }

    // ‡§ú‡•â‡§¨ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç
    function renderJobCard(job) {
        return `<div class="profile-card" style="border-left: 5px solid #ff9800;">
            <h4 style="color:#ff9800;">${job.title} (${job.shopName})</h4>
            <p style="font-size:12px;color:#555;margin-bottom:5px;">üí∞ Salary: ‚Çπ${job.salary} | üìç ${job.location}</p>
            <p style="font-size:14px;margin-bottom:10px;">${job.description.substring(0, 100)}...</p>
            <button class="whatsapp-btn" onclick="openWhatsApp('${job.phone}')">Apply/WhatsApp</button>
        </div>`;
    }

    // ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§¨‡§ü‡§® ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç
    function renderCategoryButtons() {
        const categoriesDiv = document.getElementById('mistri-categories');
        const allCategories = [
            'Plumber', 'Electrician', 'Carpenter', 'Mason', 'Painter', 
            'AC Mechanic', 'Tiler', 'Beautician', 'Home Cleaning', 'Security Guard', 
            'Laundry Service', 'Legal Consultant', 'Private Teacher', 'Computer Repair', 'Welder'
        ];
        
        categoriesDiv.innerHTML = allCategories.map(cat => 
            `<button class="cat-btn" onclick="filterByCategory('${cat}')">${cat}</button>`
        ).join('');
    }

    // ‚≠ê 1. loadCategories - ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§™‡•à‡§ú‡§ø‡§®‡•á‡§∂‡§® (Firebase ‡§ï‡§∞‡•ç‡§∏‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á)
    window.loadCategories = (loadMore = false) => {
        const listElement = document.getElementById('mistri-list');
        const loadMoreBtn = document.getElementById('load-more-providers');
        
        let queryRef;
        loadMoreBtn.style.display = 'none';
        
        // ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§≤‡•ã‡§° ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§∏‡•ç‡§ü‡•á‡§ü ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
        if (currentCategory !== null) {
            currentCategory = null; 
            filteredProviders = [];
            filteredPageIndex = 0;
            document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('selected'));
        }

        const baseRef = window.providersRef.orderByChild('timestamp');

        if (!loadMore) {
            providersLastTimestamp = null;
            providersLastKey = null;
            
            listElement.innerHTML = `<h3>Available Services (Top ${providersLimit})</h3><p style="text-align:center;color:#2a5298;">‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ${providersLimit} ‡§™‡•ç‡§∞‡•ã‡§µ‡§æ‡§á‡§°‡§∞‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</p>`;
            
            queryRef = baseRef.limitToLast(providersLimit + 1); 
        } else {
            listElement.insertAdjacentHTML('beforeend', '<p id="loading-more" style="text-align:center;color:#2a5298;">‡§î‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>');
            
            // ‡§™‡§ø‡§õ‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§ø‡§è ‡§ó‡§è ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡•á ‡§ï‡§∞‡•ç‡§∏‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§™‡•à‡§ú‡§ø‡§®‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            queryRef = baseRef.endBefore(providersLastTimestamp, providersLastKey).limitToLast(providersLimit + 1);
        }

        queryRef.once('value', (snapshot) => {
            document.getElementById('loading-more')?.remove();

            if (!loadMore && !snapshot.exists()) {
                listElement.innerHTML = '<h3>Available Services</h3><p style="text-align:center;color:#ff6666;">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!</p>';
                return;
            }

            let allItems = [];
            snapshot.forEach(childSnapshot => {
                allItems.push({ 
                    key: childSnapshot.key, 
                    data: childSnapshot.val() 
                });
            });

            allItems.reverse();

            if (loadMore && allItems.length > 0) {
                allItems.shift(); // ‡§™‡•à‡§ú‡§ø‡§®‡•á‡§∂‡§® ‡§ï‡§∞‡•ç‡§∏‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§è ‡§ó‡§è ‡§°‡•Å‡§™‡•ç‡§≤‡•Ä‡§ï‡•á‡§ü ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§¶‡•á‡§Ç
            }
            
            let itemsToRender = allItems.slice(0, providersLimit);
            
            if (itemsToRender.length > 0) {
                providersLastTimestamp = itemsToRender[itemsToRender.length - 1].data.timestamp;
                providersLastKey = itemsToRender[itemsToRender.length - 1].key;
            } 
            
            const htmlContent = itemsToRender.map(item => renderProviderCard(item.data)).join('');

            if (!loadMore) {
                listElement.innerHTML = `<h3>Available Services (${itemsToRender.length} loaded)</h3>` + htmlContent;
            } else {
                listElement.insertAdjacentHTML('beforeend', htmlContent);
            }

            // ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç ‡§ï‡§ø Firebase ‡§∏‡•á ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§î‡§∞ ‡§Ü‡§á‡§ü‡§Æ ‡§¨‡§ö‡•á ‡§π‡•à‡§Ç ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç
            if (allItems.length > providersLimit) {
                loadMoreBtn.style.display = 'block';
                loadMoreBtn.onclick = () => loadCategories(true);
            } else {
                loadMoreBtn.style.display = 'none';
                listElement.insertAdjacentHTML('beforeend', '<p style="text-align:center;color:green;font-weight:bold;">‡§≤‡§ø‡§∏‡•ç‡§ü ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§</p>');
            }

        }, (error) => {
            console.error("Error loading services:", error);
            document.getElementById('loading-more')?.remove();
            listElement.innerHTML = '<h3>Available Services</h3><p style="text-align:center;color:red;">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à‡•§</p>';
        });
    }

    // ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞‡•ç‡§° ‡§≤‡•ã‡§ï‡§≤ ‡§ê‡§∞‡•á ‡§∏‡•á ‡§™‡•á‡§ú ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç
    function renderFilteredPage(listElement, loadMoreBtn, isLoadMore = false) {
        const start = filteredPageIndex * providersLimit;
        const end = start + providersLimit;
        const itemsToRender = filteredProviders.slice(start, end);
        const totalItems = filteredProviders.length;

        if (itemsToRender.length > 0) {
            const htmlContent = itemsToRender.map(item => renderProviderCard(item)).join('');
            if (!isLoadMore) {
                // ‡§Ø‡§π‡§æ‡§Ç ‡§ü‡•ã‡§ü‡§≤ ‡§ï‡§æ‡§â‡§Ç‡§ü ‡§¶‡§ø‡§ñ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§ú‡•ã ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§è‡§Ç‡§° ‡§π‡•ã‡§®‡•á ‡§§‡§ï ‡§†‡•Ä‡§ï ‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§ó‡§æ
                listElement.innerHTML = `<h3>Available Services (${currentCategory} - ${Math.min(end, totalItems)}/${totalItems} loaded)</h3>` + htmlContent;
            } else {
                listElement.insertAdjacentHTML('beforeend', htmlContent);
            }
            filteredPageIndex++; 
        } else if (!isLoadMore) {
             listElement.innerHTML = `<h3>Available Services (${currentCategory})</h3><p style="text-align:center;color:#ff6666;">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!</p>`;
        }
        
        // ‚≠ê ‡§ï‡•ç‡§∞‡§ø‡§ü‡§ø‡§ï‡§≤ ‡§´‡§ø‡§ï‡•ç‡§∏: ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§≤‡•ã‡§° ‡§Æ‡•ã‡§∞ ‡§§‡§¨ ‡§§‡§ï ‡§¶‡§ø‡§ñ‡•á ‡§ú‡§¨ ‡§§‡§ï ‡§≤‡•ã‡§ï‡§≤ ‡§ê‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§Ü‡§á‡§ü‡§Æ ‡§¨‡§ö‡§æ ‡§π‡•ã
        if (totalItems > filteredPageIndex * providersLimit) {
            loadMoreBtn.style.display = 'block';
            loadMoreBtn.onclick = () => filterByCategory(currentCategory, true);
        } else {
            loadMoreBtn.style.display = 'none';
            listElement.insertAdjacentHTML('beforeend', '<p style="text-align:center;color:green;font-weight:bold;">‡§≤‡§ø‡§∏‡•ç‡§ü ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§</p>');
        }
    }

    // ‚≠ê 2. ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç (‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§´‡§º‡•á‡§ö ‡§ï‡§∞‡•á‡§Ç, ‡§≤‡•ã‡§ï‡§≤ ‡§∏‡•â‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç, ‡§≤‡•ã‡§ï‡§≤ ‡§™‡•à‡§ú‡§ø‡§®‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç)
    window.filterByCategory = (category, loadMore = false) => {
        const listElement = document.getElementById('mistri-list');
        const loadMoreBtn = document.getElementById('load-more-providers');
        loadMoreBtn.style.display = 'none';
        
        // ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•à‡§ú‡§ø‡§®‡•á‡§∂‡§® ‡§∏‡•ç‡§ü‡•á‡§ü ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
        providersLastTimestamp = null;
        providersLastKey = null;
        
        document.querySelectorAll('.cat-btn').forEach(btn => {
            btn.classList.remove('selected');
            if(btn.innerText === category) {
                btn.classList.add('selected');
            }
        });

        if (!loadMore) {
            // ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤ ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§≤‡•ã‡§° ‡§Ø‡§æ ‡§®‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡§æ ‡§ö‡§Ø‡§®
            currentCategory = category;
            filteredPageIndex = 0;
            // ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø ‡§∏‡§≠‡•Ä ‡§Ü‡§á‡§ü‡§Æ ‡§´‡§º‡•á‡§ö ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç
            listElement.innerHTML = `<h3>Available Services (${category})</h3><p style="text-align:center;color:#2a5298;">${category} ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à... (‡§™‡•Ç‡§∞‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§´‡•á‡§ö ‡§ï‡•Ä ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à)</p>`;

            // ‡§á‡§∏ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§≠‡•Ä ‡§Ü‡§á‡§ü‡§Æ ‡§´‡§º‡•á‡§ö ‡§ï‡§∞‡•á‡§Ç 
            window.providersRef.orderByChild('category').equalTo(category).once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    listElement.innerHTML = `<h3>Available Services (${category})</h3><p style="text-align:center;color:#ff6666;">‡§á‡§∏ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>`;
                    return;
                }

                // ‡§ê‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§®‡§µ‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç
                filteredProviders = [];
                snapshot.forEach(childSnapshot => {
                    filteredProviders.push(childSnapshot.val());
                });

                // JavaScript ‡§Æ‡•á‡§Ç ‡§ü‡§æ‡§á‡§Æ‡§∏‡•ç‡§ü‡•à‡§Æ‡•ç‡§™ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ò‡§ü‡§§‡•á ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§∏‡•â‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§™‡§π‡§≤‡•á)
                filteredProviders.sort((a, b) => b.timestamp - a.timestamp);

                // ‡§™‡§π‡§≤‡§æ ‡§™‡•á‡§ú ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç
                renderFilteredPage(listElement, loadMoreBtn);
            }, (error) => {
                console.error("Error loading filtered services:", error);
                listElement.innerHTML = '<p style="text-align:center;color:red;">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à‡•§</p>';
            });

        } else {
            // ‡§î‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (‡§¨‡§∏ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§≤‡•ã‡§ï‡§≤ ‡§ê‡§∞‡•á ‡§∏‡•á ‡§Ö‡§ó‡§≤‡§æ ‡§™‡•á‡§ú ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç)
            listElement.insertAdjacentHTML('beforeend', '<p id="loading-more" style="text-align:center;color:#2a5298;">‡§î‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>');
            
            setTimeout(() => { 
                document.getElementById('loading-more')?.remove();
                renderFilteredPage(listElement, loadMoreBtn, true);
            }, 100);
        }
    };


    // ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§∞‡•ç‡§ö
    window.searchServices = () => {
        const searchTerm = document.getElementById('main-search-bar').value.toLowerCase().trim();
        const listElement = document.getElementById('mistri-list');
        
        if (searchTerm.length < 3) {
            loadCategories(); 
            return;
        }

        listElement.innerHTML = `<h3>Search Results for "${searchTerm}"</h3><p style="text-align:center;color:#2a5298;">‡§ñ‡•ã‡§ú ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...</p>`;
        document.getElementById('load-more-providers').style.display = 'none'; 
        
        window.providersRef.once('value', (snapshot) => { 
            const providers = snapshot.val();
            let results = [];
            if (providers) {
                results = Object.values(providers).filter(p => 
                    (p.name && p.name.toLowerCase().includes(searchTerm)) || 
                    (p.category && p.category.toLowerCase().includes(searchTerm)) ||
                    (p.area && p.area.toLowerCase().includes(searchTerm))
                );
                // ‡§∏‡§∞‡•ç‡§ö ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ‡•ã‡§Ç ‡§ï‡•ã ‡§ü‡§æ‡§á‡§Æ‡§∏‡•ç‡§ü‡•à‡§Æ‡•ç‡§™ (‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§™‡§π‡§≤‡•á) ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§∏‡•â‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç
                results.sort((a, b) => b.timestamp - a.timestamp);
            }
            
            let html = `<h3>Search Results for "${searchTerm}" (${results.length} found)</h3>`;
            if (results.length > 0) {
                html += results.map(p => renderProviderCard(p)).join('');
            } else {
                html += '<p style="text-align:center;color:#ff6666;">‡§Ü‡§™‡§ï‡•Ä ‡§ñ‡•ã‡§ú ‡§∏‡•á ‡§Æ‡•á‡§≤ ‡§ñ‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ï‡•ã‡§à ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§</p>';
            }
            listElement.innerHTML = html;
        });
    };
    
    // ‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    window.logOut = () => {
        firebase.auth().signOut().then(() => {
            console.log("User signed out successfully.");
            location.reload(); // ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§™‡•á‡§ú ‡§∞‡•Ä‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        }).catch((error) => {
            console.error("Sign Out Error:", error);
             // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
            const msg = document.createElement('div');
            msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            msg.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                    <h5 class="text-lg font-bold mb-3 text-red-500">‡§∏‡§æ‡§á‡§® ‡§Ü‡§â‡§ü ‡§è‡§∞‡§∞</h5>
                    <p class="text-sm text-gray-600">Sign Out ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                    <button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>`;
            document.body.appendChild(msg);
        });
    }

    // ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§≤‡§ø‡§∏‡§®‡§∞ ‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    window.startFirebaseListener = () => {
        loadCategories(); 
        renderCategoryButtons(); 
    }

    // WHATSAPP ‡§¨‡§ü‡§® ‡§´‡§º‡§ø‡§ï‡•ç‡§∏
    function openWhatsApp(phone) {
        let num = phone.toString().replace(/[^0-9]/g, '');
        if (num.length === 10) num = '91' + num;
        if (num.length === 12 && num.startsWith('91')) {
        } else if (num.length === 13 && num.startsWith('919')) {
            num = num.substring(1);
        }
        window.open('https://wa.me/' + num, '_blank');
    }

    // ‚≠ê 3. ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® (‡§°‡•Å‡§™‡•ç‡§≤‡•Ä‡§ï‡•á‡§ü ‡§´‡§º‡•ã‡§® ‡§ö‡•á‡§ï ‡§∂‡§æ‡§Æ‡§ø‡§≤)
    function registerService() {
        const name = document.getElementById('providerName').value;
        const phone = document.getElementById('providerPhone').value;
        const category = document.getElementById('serviceCategory').value;
        const area = document.getElementById('providerArea').value;
        const experience = document.getElementById('providerExperience').value;
        const form = document.getElementById('serviceForm');

        if (!name || !phone || !category || !area || !experience) {
            // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
            const msg = document.createElement('div');
            msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-red-500">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§è‡§∞‡§∞</h5><p class="text-sm text-gray-600">‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
            document.body.appendChild(msg);
            return false;
        }
        
        if (phone.length !== 10 || isNaN(phone)) {
            // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
            const msg = document.createElement('div');
            msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-red-500">‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§è‡§∞‡§∞</h5><p class="text-sm text-gray-600">‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
            document.body.appendChild(msg);
            return false;
        }
        
        // ‡§°‡•Å‡§™‡•ç‡§≤‡•Ä‡§ï‡•á‡§ü ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡•á‡§Ç
        window.providersRef.orderByChild('phone').equalTo(phone).once('value', (snapshot) => {
            if (snapshot.exists()) {
                // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
                const msg = document.createElement('div');
                msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-red-500">‡§°‡•Å‡§™‡•ç‡§≤‡•Ä‡§ï‡•á‡§ü ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä</h5><p class="text-sm text-gray-600">‡§Ø‡§π ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§π‡•Ä ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•ã ‡§ö‡•Å‡§ï‡§æ ‡§π‡•à‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
                document.body.appendChild(msg);
                return;
            }

            // ‡§Ø‡§¶‡§ø ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§Ø‡•Ç‡§®‡•Ä‡§ï ‡§π‡•à, ‡§§‡•ã ‡§°‡•á‡§ü‡§æ ‡§™‡•Å‡§∂ ‡§ï‡§∞‡•á‡§Ç
            const providerData = {
                name: name, phone: phone, category: category, area: area,
                experience: experience + ' years',
                timestamp: firebase.database.ServerValue.TIMESTAMP 
            };

            window.providersRef.push(providerData)
                .then(() => {
                    // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
                    const msg = document.createElement('div');
                    msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-green-500">‡§∏‡§´‡§≤‡§§‡§æ</h5><p class="text-sm text-gray-600">‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•ã ‡§ó‡§à ‡§π‡•à! ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
                    document.body.appendChild(msg);
                    form.reset(); 
                    loadCategories(); 
                })
                .catch((error) => {
                    // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
            const msg = document.createElement('div');
            msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-red-500">‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§è‡§∞‡§∞</h5><p class="text-sm text-gray-600">‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
            document.body.appendChild(msg);
            return false;
        }
        
        // ‡§°‡•Å‡§™‡•ç‡§≤‡•Ä‡§ï‡•á‡§ü ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡•á‡§Ç
        window.providersRef.orderByChild('phone').equalTo(phone).once('value', (snapshot) => {
            if (snapshot.exists()) {
                // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
                const msg = document.createElement('div');
                msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-red-500">‡§°‡•Å‡§™‡•ç‡§≤‡•Ä‡§ï‡•á‡§ü ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä</h5><p class="text-sm text-gray-600">‡§Ø‡§π ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§π‡•Ä ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•ã ‡§ö‡•Å‡§ï‡§æ ‡§π‡•à‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
                document.body.appendChild(msg);
                return;
            }

            // ‡§Ø‡§¶‡§ø ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§Ø‡•Ç‡§®‡•Ä‡§ï ‡§π‡•à, ‡§§‡•ã ‡§°‡•á‡§ü‡§æ ‡§™‡•Å‡§∂ ‡§ï‡§∞‡•á‡§Ç
            const providerData = {
                name: name, phone: phone, category: category, area: area,
                experience: experience + ' years',
                timestamp: firebase.database.ServerValue.TIMESTAMP 
            };

            window.providersRef.push(providerData)
                .then(() => {
                    // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
                    const msg = document.createElement('div');
                    msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-green-500">‡§∏‡§´‡§≤‡§§‡§æ</h5><p class="text-sm text-gray-600">‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•ã ‡§ó‡§à ‡§π‡•à! ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
                    document.body.appendChild(msg);
                    form.reset(); 
                    loadCategories(); 
                })
                .catch((error) => {
                    // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
                    const msg = document.createElement('div');
                    msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-red-500">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§è‡§∞‡§∞</h5><p class="text-sm text-gray-600">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à: ${error.message}</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
                    document.body.appendChild(msg);
                    console.error("Firebase Error:", error);
                });
        });
        
        return false; 
    }
    // ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡§æ ‡§Ö‡§Ç‡§§

    // ‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    function jobRegister() {
        const title = document.getElementById('jobTitle').value;
        const shopName = document.getElementById('jobShopName').value;
        const location = document.getElementById('jobLocation').value;
        const salary = document.getElementById('jobSalary').value;
        const description = document.getElementById('jobDescription').value;
        const phone = document.getElementById('jobPhone').value;
        const form = document.getElementById('jobForm');

        if (!title || !shopName || !location || !salary || !description || !phone) {
            // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
            const msg = document.createElement('div');
            msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-red-500">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§è‡§∞‡§∞</h5><p class="text-sm text-gray-600">‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡•â‡§¨ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§ï‡•á ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
            document.body.appendChild(msg);
            return false;
        }

        if (phone.length !== 10 || isNaN(phone)) {
            // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
            const msg = document.createElement('div');
            msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-red-500">‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§è‡§∞‡§∞</h5><p class="text-sm text-gray-600">‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
            document.body.appendChild(msg);
            return false;
        }

        const jobData = {
            title: title, shopName: shopName, location: location, salary: salary,
            description: description, phone: phone, 
            timestamp: firebase.database.ServerValue.TIMESTAMP 
        };

        window.jobsRef.push(jobData) 
            .then(() => {
                // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
                const msg = document.createElement('div');
                msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-green-500">‡§∏‡§´‡§≤‡§§‡§æ</h5><p class="text-sm text-gray-600">‡§ú‡•â‡§¨ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•ã ‡§ó‡§à ‡§π‡•à! ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
                document.body.appendChild(msg);
                form.reset(); 
                if(document.getElementById('jobs-screen').classList.contains('active')) loadJobs();
            })
            .catch((error) => {
                 // alert ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ø‡•Ç‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
                const msg = document.createElement('div');
                msg.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                msg.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full"><h5 class="text-lg font-bold mb-3 text-red-500">‡§ú‡•â‡§¨ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§è‡§∞‡§∞</h5><p class="text-sm text-gray-600">‡§ú‡•â‡§¨ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à: ${error.message}</p><button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button></div>`;
                document.body.appendChild(msg);
                console.error("Firebase Job Error:", error);
            });

        return false;
    }
        
    window.onload = () => {
        firebase.initializeApp(firebaseConfig);
        window.database = firebase.database();
        window.providersRef = database.ref('service_providers'); 
        window.jobsRef = database.ref('local_jobs'); 

        // 1. ‡§Ö‡§¶‡•É‡§∂‡•ç‡§Ø reCAPTCHA ‡§∏‡•á‡§ü‡§Ö‡§™
        recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
            'size': 'invisible'
        });
        recaptchaVerifier.render();

        // 2. ‡§™‡§∞‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ö‡•á‡§ï: ‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§ë‡§•‡•á‡§Ç‡§ü‡§ø‡§ï‡•á‡§∂‡§® ‡§∏‡•ç‡§ü‡•á‡§ü ‡§≤‡§ø‡§∏‡§®‡§∞
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById('registrationScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                console.log("Auto-Login Successful:", user.phoneNumber);

                startFirebaseListener();
                
                if (typeof loadPromotionAds === 'function') {
                    loadPromotionAds();
                    setTimeout(loadPromotionAds, 2000);
                }
            } else {
                document.getElementById('registrationScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        });


        // 3. ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§: OTP ‡§≠‡•á‡§ú‡•á‡§Ç (‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡•ç‡§ü‡•á‡§™ 1) - ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø OTP ‡§´‡§º‡•ç‡§≤‡•ã ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§π‡•à
        document.getElementById('sendOtpBtn').onclick = () => {
            const name = document.getElementById('userName').value.trim();
            const area = document.getElementById('userArea').value.trim();
            const phone = document.getElementById('phoneInput').value.trim();
            
            if (!name || !area || phone.length !== 10 || isNaN(phone)) {
                document.getElementById('loginMsg').innerHTML = "<span style='color:red'>‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° (‡§®‡§æ‡§Æ, ‡§è‡§∞‡§ø‡§Ø‡§æ) ‡§≠‡§∞‡•á‡§Ç ‡§î‡§∞ 10 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç‡•§</span>";
                return;
            }

            tempUserData = {
                name: name,
                area: area,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            document.getElementById('sendOtpBtn').innerHTML = "Sending...";
            const fullPhone = '+91' + phone;

            // ‡§®‡§Ø‡§æ OTP ‡§≠‡•á‡§ú‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§ï‡•ã ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§´‡§º‡§ø‡§ï‡•ç‡§∏)
            firebase.auth().signOut()
                .then(() => initiateOtpFlow(fullPhone))
                .catch(() => initiateOtpFlow(fullPhone)); 

            function initiateOtpFlow(fullPhone) {
                recaptchaVerifier.verify().then(() => {
                    firebase.auth().signInWithPhoneNumber(fullPhone, recaptchaVerifier)
                        .then((result) => {
                            confirmationResult = result;
                            document.getElementById('profileInputSection').style.display = 'none'; 
                            document.getElementById('otpSection').style.display = 'block'; 
                            document.getElementById('sendOtpBtn').innerHTML = "Send OTP & Sign Up"; // ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                            document.getElementById('loginMsg').innerHTML = `<span style='color:green'>OTP ${fullPhone} ‡§™‡§∞ ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ!</span>`;
                        })
                        .catch((err) => {
                            document.getElementById('loginMsg').innerHTML = `<span style='color:red'>OTP ‡§è‡§∞‡§∞: ${err.message}</span>`;
                            document.getElementById('sendOtpBtn').innerHTML = "Send OTP & Sign Up";
                            document.getElementById('profileInputSection').style.display = 'block';
                            document.getElementById('otpSection').style.display = 'none';
                        });
                }).catch((err) => {
                    document.getElementById('loginMsg').innerHTML = `<span style='color:red'>Recaptcha ‡§è‡§∞‡§∞: ${err.message}</span>`;
                    document.getElementById('sendOtpBtn').innerHTML = "Send OTP & Sign Up";
                });
            }
        };


        // 4. OTP ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç (‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡•ç‡§ü‡•á‡§™ 2) - OTP ‡§¨‡§æ‡§à‡§™‡§æ‡§∏ ‡§ï‡•ã ‡§∞‡•ã‡§ï‡§§‡§æ ‡§π‡•à
        document.getElementById('verifyOtpBtn').onclick = () => {
            const otp = document.getElementById('otpInput').value;
            if (otp.length !== 6) {
                document.getElementById('loginMsg').innerHTML = "<span style='color:red'>‡§ï‡•É‡§™‡§Ø‡§æ 6 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ OTP ‡§°‡§æ‡§≤‡•á‡§Ç‡•§</span>";
                return;
            }
            document.getElementById('verifyOtpBtn').innerHTML = "Verifying...";

            confirmationResult.confirm(otp)
                .then((result) => {
                    const user = result.user;
                    if (user && user.uid) {
                        window.database.ref('users/' + user.uid).set(tempUserData)
                            .then(() => {
                                document.getElementById('loginMsg').innerHTML = "<span style='color:green'>Login Successful! Redirecting...</span>";
                                // ‚≠ê CRITICAL FIX: ‡§∏‡§´‡§≤ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§∞‡§ø‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
                                location.reload(); 
                            })
                            .catch(error => {
                                console.error("Profile save error:", error);
                                document.getElementById('loginMsg').innerHTML = "<span style='color:red'>Login Successful, but profile save failed. Please contact support.</span>";
                                document.getElementById('verifyOtpBtn').innerHTML = "Verify OTP";
                            });
                    } else {
                        document.getElementById('loginMsg').innerHTML = "<span style='color:red'>Verification Failed: User not returned.</span>";
                        document.getElementById('verifyOtpBtn').innerHTML = "Verify OTP";
                    }
                })
                .catch(() => {
                    document.getElementById('loginMsg').innerHTML = "<span style='color:red'>‡§ó‡§º‡§≤‡§§ OTP! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä 6 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ OTP ‡§°‡§æ‡§≤‡•á‡§Ç‡•§</span>";
                    document.getElementById('verifyOtpBtn').innerHTML = "Verify OTP";
                });
        };

        // ‡§è‡§ï‡•ç‡§∏‡•ç‡§ü‡•ç‡§∞‡§æ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
        window.contactForAds = () => window.open('https://wa.me/919889904191?text=Hello! Main apne business ka ad lagwana chahta hoon Fatehpur Hubs pe', '_blank');
        window.shareApp = () => navigator.share ? navigator.share({title: 'Fatehpur Hubs', text: 'Best local services app', url: 'https://www.fatehpurhubs.co.in'}) : alert('Share link: https://www.fatehpurhubs.co.in');
        window.showScreen = (id) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'jobs-screen') loadJobs();
            if(id === 'home-screen') loadCategories(); 
        };
        // PWA ‡§∏‡•á‡§ü‡§Ö‡§™
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker Registered'))
                    .catch(err => console.log('SW Error:', err));
            });
        }
    };
    </script>
</body>
</html>
