<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fatehpur Hubs - Local Services & Jobs</title>
    <!-- 1. Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- üö® PWA Manifest Link (‡§á‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡•á‡§Ç/‡§∏‡§π‡•Ä ‡§ï‡§∞‡•á‡§Ç) üö® -->
    <link rel="manifest" href="manifest.json?v=3.0">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script type="text/javascript" src="script.js"></script>
    <script type="text/javascript" src="ads.js"></script>
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Container for mobile simulation */
        #app-container {
            width: 100%;
            max-width: 420px;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header Style */
        #app-header {
            background-color: #2a5298; /* Dark Blue */
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .logout-btn {
            background-color: #ff4d4f; /* Red for emphasis */
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .logout-btn:hover {
            background-color: #d9363e;
        }

        /* Navigation Bar */
        #nav-bar {
            display: flex;
            justify-content: space-around;
            background-color: #fff;
            border-top: 1px solid #eee;
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }
        .nav-item {
            flex-grow: 1;
            text-align: center;
            padding: 10px 0;
            cursor: pointer;
            color: #777;
            font-size: 0.75rem;
            transition: color 0.2s;
        }
        .nav-item.active {
            color: #2a5298;
        }
        .nav-item i {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 3px;
        }

        /* Main Content Area */
        #mainApp {
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 130px; /* Space for fixed navbar */
        }
        .screen {
            display: none;
            padding: 15px;
            min-height: 100%;
        }
        .screen.active {
            display: block;
        }

        /* Registration Screen Style */
        #registrationScreen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            text-align: center;
            height: 100vh;
        }
        #registrationScreen h2 {
            color: #2a5298;
            margin-bottom: 20px;
        }
        .input-group, #otpSection {
            width: 100%;
            margin-bottom: 15px;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
        }
        .main-btn {
            background-color: #2a5298;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: background-color 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        .main-btn:hover {
            background-color: #1e3a66;
        }
        #loginMsg {
            margin-top: 15px;
            font-weight: 600;
        }

        /* Home/List Styles */
        #mistri-categories {
            display: flex;
            overflow-x: auto;
            padding: 10px 0;
            white-space: nowrap;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .cat-btn {
            padding: 8px 15px;
            margin-right: 10px;
            background-color: #e5e7eb;
            color: #333;
            border: none;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            flex-shrink: 0;
        }
        .cat-btn.selected {
            background-color: #2a5298;
            color: white;
            font-weight: bold;
        }

        /* Search Bar */
        #search-container {
            margin-bottom: 15px;
        }
        #main-search-bar {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        /* Profile Card */
        .profile-card {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #ffc107; /* Yellow border for Providers */
        }
        .profile-card h4 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
        }
        .profile-card p {
            margin: 0;
            font-size: 0.9rem;
        }
        .whatsapp-btn, .contact-btn, .share-btn {
            padding: 8px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        .whatsapp-btn {
            background-color: #25d366;
            color: white;
        }
        .contact-btn {
            background-color: #007bff;
            color: white;
        }
        .share-btn {
            background-color: #9c27b0;
            color: white;
        }

        /* Promotion Ad Card */
        .ad-card {
            background-color: #e3f2fd; /* Light blue */
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            border: 1px dashed #2a5298;
        }
        .ad-card button {
            background-color: #ff9800;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Form Styles */
        .form-container {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        .form-container h3 {
            color: #2a5298;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .form-field {
            margin-bottom: 15px;
        }
        .form-field label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        .form-field input, .form-field select, .form-field textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 0.95rem;
        }
        .submit-btn {
            background-color: #4caf50; /* Green submit button */
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
        }

    </style>
</head>
<body>
    <div id="app-container">

        <!-- -------------------- LOGOUT AND AUTH SCREEN -------------------- -->
        <div id="registrationScreen" style="display: none;">
            <h2>Fatehpur Hubs: Services & Jobs</h2>
            <div id="loginMsg">‡§ï‡•É‡§™‡§Ø‡§æ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</div>

            <div id="profileInputSection" class="input-group">
                <input type="text" id="userName" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ (Name)" required>
                <input type="text" id="userArea" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§è‡§∞‡§ø‡§Ø‡§æ/‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡§æ (Area)" required style="margin-top: 10px;">
                <input type="number" id="phoneInput" placeholder="10 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞" maxlength="10" required style="margin-top: 10px;">
                <button id="sendOtpBtn" class="main-btn">Send OTP & Sign Up</button>
            </div>

            <div id="otpSection" class="input-group" style="display: none;">
                <input type="number" id="otpInput" placeholder="6 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ OTP" maxlength="6" required>
                <button id="verifyOtpBtn" class="main-btn">Verify OTP & Login</button>
            </div>
            
            <p style="font-size: 0.8rem; color: #777; margin-top: 20px;">Firebase Phone Authentication ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡•§</p>
            <div id="recaptcha-container"></div>
        </div>

        <!-- -------------------- MAIN APPLICATION UI -------------------- -->
        <div id="mainApp" style="display: none;">

            <!-- Header with Logout Button -->
            <header id="app-header">
                <div class="logo">Fatehpur Hubs</div>
                <button class="logout-btn" onclick="window.logOut()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </header>

            <!-- Main Content Screens -->
            <div id="mainAppContent">

                <!-- 1. HOME/MISTRI SCREEN -->
                <div id="home-screen" class="screen active">
                    <!-- TOP Ad Placeholder -->
                    <div class="ad-container">
        <!-- Ad Script 1 -->
        <script type="text/javascript">
            atOptions = { 'key' : '969a80a2e6bea9f00173f36024f32cb2', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
            document.write('<script type="text/javascript" src="//www.highperformanceformat.com/969a80a2e6bea9f00173f36024f32cb2/invoke.js"><\/script>');
        </script>
                    </div>
                    <div id="ad-placeholder-top" class="ad-card" onclick="window.contactForAds()">
                        <p style="font-size: 1.1rem; font-weight: bold; color: #2a5298;">ü§ù ‡§Ö‡§™‡§®‡•á ‡§¨‡§ø‡§ú‡§º‡§®‡•á‡§∏ ‡§ï‡§æ Ad ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ó‡§µ‡§æ‡§è‡§Å! (Top Ad)</p>
                        <p style="font-size: 0.9rem; color: #555;">‡§Ö‡§™‡§®‡•á ‡§ï‡§∏‡•ç‡§ü‡§Æ‡§∞‡•ç‡§∏ ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡•á‡§Ç‡•§</p>
                        <button>Contact for Ads</button>
                    </div>

                    <!-- Search -->
                    <div id="search-container">
                        <input type="text" id="main-search-bar" placeholder="‡§∏‡•á‡§µ‡§æ ‡§Ø‡§æ ‡§è‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç..." onkeyup="searchServices()">
                    </div>

                    <!-- Categories -->
<div id="mistri-categories" class="categories-grid">
    <!-- EXISTING CATEGORIES -->
    <button class="cat-btn" onclick="filterByCategory('Plumber')">Plumber</button>
    <button class="cat-btn" onclick="filterByCategory('Electrician')">Electrician</button>
    <button class="cat-btn" onclick="filterByCategory('Carpenter')">Carpenter</button>
    <button class="cat-btn" onclick="filterByCategory('Mason')">Mason</button>
    <button class="cat-btn" onclick="filterByCategory('Painter')">Painter</button>
    <button class="cat-btn" onclick="filterByCategory('AC Mechanic')">AC Mechanic</button>
    <button class="cat-btn" onclick="filterByCategory('Tiler')">Tiler</button>
    <button class="cat-btn" onclick="filterByCategory('Beautician')">Beautician</button>
    <button class="cat-btn" onclick="filterByCategory('Home Cleaning')">Home Cleaning</button>
    <button class="cat-btn" onclick="filterByCategory('Security Guard')">Security Guard</button>
    <button class="cat-btn" onclick="filterByCategory('Laundry Service')">Laundry Service</button>
    <button class="cat-btn" onclick="filterByCategory('Legal Consultant')">Legal Consultant</button>
    <button class="cat-btn" onclick="filterByCategory('Private Teacher')">Private Teacher</button>
    <button class="cat-btn" onclick="filterByCategory('Computer Repair')">Computer Repair</button>
    <button class="cat-btn" onclick="filterByCategory('Welder')">Welder</button>
    
    <!-- NEW CATEGORIES (‡§ú‡§ø‡§®‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§ü‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Ü ‡§∞‡§π‡•á ‡§•‡•á) -->
    <button class="cat-btn" onclick="filterByCategory('DJ Service')">DJ Service</button>
    <button class="cat-btn" onclick="filterByCategory('Driver')">Driver</button>
    <button class="cat-btn" onclick="filterByCategory('Catering')">Catering</button>
    <button class="cat-btn" onclick="filterByCategory('Event Planner')">Event Planner</button>
    <button class="cat-btn" onclick="filterByCategory('Photographer')">Photographer</button>
    <button class="cat-btn" onclick="filterByCategory('Car Mechanic')">Car Mechanic</button>
</div>

                    

                    <!-- Provider List (Services will be loaded here) -->
                    <div id="mistri-list">
                        <!-- Services will be loaded here -->
                    </div>
                    
                    <!-- -------------------- MIDDLE AD UNIT (300x250) -------------------- -->
                    <div class="ad-container" style="
                        width: 300px; /* 300px width */
                        height: 250px; 
                        margin: 20px auto; 
                        border: 1px solid #ddd;
                        text-align: center;">
                        
                        <!-- Ad Script 2: Your 300x250 Adsterra Code -->
                        <script type="text/javascript">
                            atOptions = {
                                'key' : 'd65603602583bbe6bc3308e8ee8ab792',
                                'format' : 'iframe',
                                'height' : 250,
                                'width' : 300,
                                'params' : {}
                            };
                        </script>
                        <script type="text/javascript" src="//www.highperformanceformat.com/d65603602583bbe6bc3308e8ee8ab792/invoke.js"></script>
                    </div>
                    <!-- -------------------------------------------------------------------- -->

                    <button id="load-more-providers" class="main-btn" style="display:none; margin-top: 15px; margin-bottom: 15px;" onclick="loadCategories(true)">
                        Load More Services
                    </button>

                    
                </div>

                <!-- 2. SERVICE ADD SCREEN -->
                <div id="add-service-screen" class="screen">
                    <div class="form-container">
                        <h3>üîß ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§™‡•ç‡§∞‡•ã‡§µ‡§æ‡§á‡§°‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
                        <form id="serviceForm" onsubmit="return registerService()">
                            <div class="form-field">
                                <label for="providerName">‡§®‡§æ‡§Æ</label>
                                <input type="text" id="providerName" required>
                            </div>
                            <div class="form-field">
                                <label for="providerPhone">‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ (10 ‡§Ö‡§Ç‡§ï)</label>
                                <input type="number" id="providerPhone" maxlength="10" required>
                            </div>
                            <div class="form-field">
                                <label for="serviceCategory">‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</label>
                                <select id="serviceCategory" required>
                                    <option value="">-- ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
                                    <option value="Plumber">‡§™‡•ç‡§≤‡§Æ‡•ç‡§¨‡§∞ (Plumber)</option>
                                    <option value="Electrician">‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä‡§∂‡§ø‡§Ø‡§® (Electrician)</option>
                                    <option value="Carpenter">‡§¨‡§¢‡§º‡§à (Carpenter)</option>
                                    <option value="Mason">‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä (Mason)</option>
                                    <option value="Painter">‡§™‡•á‡§Ç‡§ü‡§∞ (Painter)</option>
                                    <option value="AC Mechanic">AC ‡§Æ‡•à‡§ï‡•á‡§®‡§ø‡§ï</option>
                                    <option value="Tiler">‡§ü‡§æ‡§á‡§≤‡§∞ (Tiler)</option>
                                    <option value="Beautician">‡§¨‡•ç‡§Ø‡•Ç‡§ü‡•Ä‡§∂‡§ø‡§Ø‡§®</option>
                                    <option value="Home Cleaning">‡§π‡•ã‡§Æ ‡§ï‡•ç‡§≤‡•Ä‡§®‡§ø‡§Ç‡§ó</option>
                                    <option value="Security Guard">‡§∏‡§ø‡§ï‡•ç‡§Ø‡•ã‡§∞‡§ø‡§ü‡•Ä ‡§ó‡§æ‡§∞‡•ç‡§°</option>
                                    <option value="Laundry Service">‡§≤‡•â‡§®‡•ç‡§°‡•ç‡§∞‡•Ä ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏</option>
                                    <option value="Legal Consultant">‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä ‡§∏‡§≤‡§æ‡§π‡§ï‡§æ‡§∞</option>
                                    <option value="Private Teacher">‡§™‡•ç‡§∞‡§æ‡§á‡§µ‡•á‡§ü ‡§ü‡•Ä‡§ö‡§∞</option>
                                    <option value="Computer Repair">‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞/‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞</option>
                                    <option value="Welder">‡§µ‡•á‡§≤‡•ç‡§°‡§∞</option>
                                    <!-- NEW CATEGORIES -->
    <option value="DJ Service">DJ ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏</option>
    <option value="Driver">‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option>
    <option value="Catering">‡§ï‡•á‡§ü‡§∞‡§ø‡§Ç‡§ó ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏</option>
    <option value="Event Planner">‡§á‡§µ‡•á‡§Ç‡§ü ‡§™‡•ç‡§≤‡§æ‡§®‡§∞</option>
    <option value="Photographer">‡§´‡•ã‡§ü‡•ã‡§ó‡•ç‡§∞‡§æ‡§´‡§∞</option>
    <option value="Car Mechanic">‡§ï‡§æ‡§∞ ‡§Æ‡•à‡§ï‡•á‡§®‡§ø‡§ï</option>
                                
                                </select>
                            </div>
                            <div class="form-field">
                                <label for="providerArea">‡§è‡§∞‡§ø‡§Ø‡§æ/‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡§æ</label>
                                <input type="text" id="providerArea" required>
                            </div>
                            <div class="form-field">
                                <label for="providerExperience">‡§Ö‡§®‡•Å‡§≠‡§µ (‡§∏‡§æ‡§≤‡•ã‡§Ç ‡§Æ‡•á‡§Ç)</label>
                                <input type="number" id="providerExperience" required min="0">
                            </div>
                            <button type="submit" class="submit-btn">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
                        </form>
                    </div>
                </div>

                <!-- 3. JOB SCREEN (Pending implementation details for loadJobs) -->
                <div id="jobs-screen" class="screen">
                    <div class="form-container">
                        <h3>üíº ‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</h3>
                        <form id="jobForm" onsubmit="event.preventDefault(); return registerJob();">
                            <div class="form-field">
                                <label for="jobTitle">‡§ú‡•â‡§¨ ‡§ü‡§æ‡§á‡§ü‡§≤ (‡§ú‡•à‡§∏‡•á: ‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡•à‡§®)</label>
                                <input type="text" id="jobTitle" required>
                            </div>
                            <div class="form-field">
                                <label for="jobShopName">‡§¶‡•Å‡§ï‡§æ‡§®/‡§ï‡§Ç‡§™‡§®‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                                <input type="text" id="jobShopName" required>
                            </div>
                            <div class="form-field">
                                <label for="jobLocation">‡§ú‡•â‡§¨ ‡§≤‡•ã‡§ï‡•á‡§∂‡§®</label>
                                <input type="text" id="jobLocation" required>
                            </div>
                            <div class="form-field">
                                <label for="jobSalary">‡§∏‡•à‡§≤‡§∞‡•Ä/‡§µ‡•á‡§§‡§®</label>
                                <input type="number" id="jobSalary" required min="1000">
                            </div>
                             <div class="form-field">
                                <label for="jobPhone">‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ (10 ‡§Ö‡§Ç‡§ï)</label>
                                <input type="number" id="jobPhone" maxlength="10" required>
                            </div>
                            <div class="form-field">
                                <label for="jobDescription">‡§ú‡•â‡§¨ ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ (Details)</label>
                                <textarea id="jobDescription" rows="3" required></textarea>
                            </div>
                            <button type="submit" class="submit-btn" style="background-color: #ff9800;">‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                        </form>
                    </div>

                    <h3 style="color: #2a5298;">üåü ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡•å‡§ï‡§∞‡§ø‡§Ø‡§æ‡§Å</h3>
                    <div id="job-list">
                         <p style="text-align:center; color:#555;">‡§ú‡•â‡§¨ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡•ã‡§° ‡§π‡•ã‡§Ç‡§ó‡•Ä‡•§ (Job loading function is currently mock/needs full implementation)</p>
                    </div>
                </div>

                 <!-- 4. SHARE SCREEN -->
                <div id="share-screen" class="screen">
                    <div class="ad-card" style="margin-top: 30px; padding: 40px;">
                        <i class="fas fa-share-alt" style="font-size: 3rem; color: #2a5298; margin-bottom: 15px;"></i>
                        <h3 style="color: #2a5298; margin-bottom: 10px;">Fatehpur Hubs ‡§ï‡•ã ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç!</h3>
                        <p>‡§Ø‡§π ‡§ê‡§™ ‡§´‡§§‡•á‡§π‡§™‡•Å‡§∞ ‡§ï‡•á ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§∏‡•á ‡§Ö‡§™‡§®‡•á ‡§¶‡•ã‡§∏‡•ç‡§§‡•ã‡§Ç ‡§î‡§∞ ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                        <button onclick="window.shareApp()" class="main-btn" style="background-color: #00bcd4;">
                            <i class="fas fa-paper-plane"></i> ‡§Ö‡§≠‡•Ä ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    </div>
                </div>

            </div>

    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyA37JsLUIG-kypZ55vdpLTp3WKHgRH2IwY",
        authDomain: "fatehpur-hubs-a3a9f.firebaseapp.com",
        databaseURL: "https://fatehpur-hubs-a3a9f-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "fatehpur-hubs-a3a9f",
        storageBucket: "fatehpur-hubs-a3a9f.appspot.com",
        messagingSenderId: "294360741451",
        appId: "1:294360741451:web:3bc85078805750b9fabfce"
    };

    let recaptchaVerifier, confirmationResult;
    let tempUserData = {}; 
    
    // ‚≠ê GLOBAL STATE AND LIMITS ‚≠ê
    const providersLimit = 20; 
    let providersLastTimestamp = null; 
    let providersLastKey = null; 
    let currentCategory = null; 
    
    // ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡•ã‡§ï‡§≤ ‡§ê‡§∞‡•á ‡§î‡§∞ ‡§™‡•á‡§ú ‡§á‡§Ç‡§°‡•á‡§ï‡•ç‡§∏ (Category Pagination Fix)
    let filteredProviders = [];
    let filteredPageIndex = 0;
    
    let jobsLastKey = null;
    const jobsLimit = 10;
    
    // --- AD CARD RENDERER (New Helper Function) ---
    function renderAdCard(id, title = "‡§Ö‡§™‡§®‡•á ‡§¨‡§ø‡§ú‡§º‡§®‡•á‡§∏ ‡§ï‡§æ Ad ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ó‡§µ‡§æ‡§è‡§Å!") {
        // ‡§Ø‡§π ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡§æ HTML ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à
        return `<div id="${id}" class="ad-card" onclick="window.contactForAds()">
            <p style="font-size: 1.1rem; font-weight: bold; color: #2a5298;">ü§ù ${title}</p>
            <p style="font-size: 0.9rem; color: #555;">‡§Ö‡§™‡§®‡•á ‡§ï‡§∏‡•ç‡§ü‡§Æ‡§∞‡•ç‡§∏ ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡•á‡§Ç‡•§</p>
            <button>Contact for Ads</button>
        </div>`;
    }
    // --- END AD CARD RENDERER ---

    // --- MOCK JOB LOAD FUNCTION (TO PREVENT ERRORS) ---
    function loadJobs() {
        const listElement = document.getElementById('job-list');
        listElement.innerHTML = `<p style="text-align:center;color:#2a5298;">‡§®‡•å‡§ï‡§∞‡§ø‡§Ø‡§æ‡§Å ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...</p>`;

        window.jobsRef.limitToLast(jobsLimit).once('value', (snapshot) => {
            if (!snapshot.exists()) {
                listElement.innerHTML = '<p style="text-align:center;color:#ff6666;">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§®‡•å‡§ï‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>';
                return;
            }
            
            let allJobs = [];
            snapshot.forEach(childSnapshot => {
                allJobs.push(childSnapshot.val());
            });

            allJobs.reverse(); // ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§™‡§π‡§≤‡•á
            
            const htmlContent = allJobs.map(job => renderJobCard(job)).join('');
            listElement.innerHTML = htmlContent;

        }, (error) => {
            console.error("Error loading jobs:", error);
            listElement.innerHTML = '<p style="text-align:center;color:red;">‡§ú‡•â‡§¨‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à‡•§</p>';
        });
    }
    // --- END MOCK JOB LOAD FUNCTION ---

    // ‡§∂‡•á‡§Ø‡§∞ ‡§°‡•Ä‡§ü‡•á‡§≤‡•ç‡§∏ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    window.shareProviderDetails = (name, phone, category) => {
        const shareText = `‡§®‡§æ‡§Æ: ${name} (${category})\n‡§´‡§º‡•ã‡§®: ${phone}\n\nFatehpur Hubs App ‡§ï‡•á ‡§ú‡§º‡§∞‡§ø‡§è ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§™‡•ç‡§∞‡•ã‡§µ‡§æ‡§á‡§°‡§∞ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§Æ‡§ø‡§≤‡•Ä‡•§`;
        if (navigator.share) {
            navigator.share({
                title: 'Service Provider Contact',
                text: shareText
            }).catch(error => console.error('Sharing failed', error));
        } else {
            alert(`Contact Details:\n${shareText}`);
        }
    }
          // // ‡§™‡•ç‡§∞‡•ã‡§µ‡§æ‡§á‡§°‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç
function renderProviderCard(p) {
    // p.key ‡§ï‡•ã ‡§∞‡§ø‡§µ‡•ç‡§Ø‡•Ç ‡§∏‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ID ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§π‡§∞ ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä ‡§ï‡§æ ‡§∏‡•á‡§ï‡•ç‡§∂‡§® ‡§Ö‡§≤‡§ó ‡§∞‡§π‡•á‡•§
    return `<div class="profile-card">
        <h4 style="color:#2a5298;">${p.name} - (${p.category})</h4>
        <p style="font-size:12px;color:#555;">üìç ${p.area} | Experience: ${p.experience}</p>

        <div style="margin-top:10px; display: flex; justify-content: space-between; gap: 5px;">
            <button class="whatsapp-btn flex-1" onclick="openWhatsApp('${p.phone}')">WhatsApp</button>
            <button class="contact-btn flex-1" onclick="window.location.href='tel:${p.phone}'">Call Now</button>
            <button class="share-btn flex-1" onclick="shareProviderDetails('${p.name}', '${p.phone}', '${p.category}')">Share</button>
        </div>
    </div>`;
        }
        
    // ‡§ú‡•â‡§¨ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç
    function renderJobCard(job) {
        return `<div class="profile-card" style="border-left: 5px solid #ff9800;">
            <h4 style="color:#ff9800;">${job.title} (${job.shopName})</h4>
            <p style="font-size:12px;color:#555;margin-bottom:5px;">üí∞ Salary: ‚Çπ${job.salary} | üìç ${job.location}</p>
            <p style="font-size:14px;margin-bottom:10px;">${job.description.substring(0, 100)}...</p>
            <button class="whatsapp-btn" onclick="openWhatsApp('${job.phone}')">Apply/WhatsApp</button>
        </div>`;
    }

    // ‚≠ê 1. loadCategories - ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§™‡•à‡§ú‡§ø‡§®‡•á‡§∂‡§® (Ads injected)
window.loadCategories = (loadMore = false) => {
    const listElement = document.getElementById('mistri-list');
    const loadMoreBtn = document.getElementById('load-more-providers');
    
    let queryRef;
    loadMoreBtn.style.display = 'none';
    const providersLimit = 10; // Firebase ‡§≤‡•ã‡§° ‡§≤‡§ø‡§Æ‡§ø‡§ü
    
    // ‡§Ö‡§ó‡§∞ ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§Æ‡•á‡§Ç ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§™‡§π‡§≤‡•á ‡§â‡§∏‡•á ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
    if (currentCategory !== null) {
        currentCategory = null; 
        filteredProviders = [];
        filteredPageIndex = 0;
        document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('selected'));
    }

    const baseRef = window.providersRef.orderByChild('timestamp');

    if (!loadMore) {
        providersLastTimestamp = null;
        providersLastKey = null;
        
        listElement.innerHTML = `<h3>Available Services (Top ${providersLimit})</h3><p style="text-align:center;color:#2a5298;">‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ${providersLimit} ‡§™‡•ç‡§∞‡•ã‡§µ‡§æ‡§á‡§°‡§∞‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</p>`;
        
        queryRef = baseRef.limitToLast(providersLimit + 1); 
    } else {
        listElement.insertAdjacentHTML('beforeend', '<p id="loading-more" style="text-align:center;color:#2a5298;">‡§î‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>');
        
        queryRef = baseRef.endBefore(providersLastTimestamp, providersLastKey).limitToLast(providersLimit + 1);
    }

    queryRef.once('value', (snapshot) => {
        document.getElementById('loading-more')?.remove();

        if (!loadMore && !snapshot.exists()) {
            listElement.innerHTML = '<h3>Available Services</h3><p style="text-align:center;color:#ff6666;">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!</p>';
            return;
        }

        let allItems = [];
        let snapshotSize = 0; 
        
        snapshot.forEach(childSnapshot => {
            allItems.push({ 
                key: childSnapshot.key, 
                data: childSnapshot.val() 
            });
            snapshotSize++; 
        });

        allItems.reverse();
        
        if (loadMore && allItems.length > 0) {
            allItems.shift(); // ‡§™‡§ø‡§õ‡§≤‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ï‡§æ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ü‡§á‡§ü‡§Æ ‡§õ‡•ã‡§°‡§º ‡§¶‡•á‡§Ç
        }
        
        let itemsToRender = allItems.slice(0, providersLimit);
        
        if (itemsToRender.length > 0) {
            providersLastTimestamp = itemsToRender[itemsToRender.length - 1].data.timestamp;
            providersLastKey = itemsToRender[itemsToRender.length - 1].key;
        } 
        
        // --- AD INJECTION LOGIC (General List - Every 4 Cards) ---
        let contentArray = [];
        const adInjectionInterval = 4; // ‡§π‡§∞ 4 ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§è‡§° ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å

        for (let i = 0; i < itemsToRender.length; i++) {
            // 1. ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
            contentArray.push(window.renderProviderCard(itemsToRender[i].data));
            
            // 2. ‡§è‡§° ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§π‡§∞ 4 ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡•á ‡§¨‡§æ‡§¶)
            // ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§è‡§° ‡§Ü‡§ñ‡§º‡§ø‡§∞‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§® ‡§Ü‡§è
            if ((i + 1) % adInjectionInterval === 0 && (i + 1) < itemsToRender.length) {
                contentArray.push(`
                    <!-- **PROMOTION AD INJECTION POINT** -->
                    <div class="promotion-ad-block" 
                         style="text-align: center; margin: 30px 0; padding: 10px; border: 1px dashed #ffc107; border-radius: 8px; background-color: #fff8e1;">
                        <p style="font-size: 0.9em; color: #ff9800; font-weight: bold; margin-bottom: 10px;">-- ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§™‡•ç‡§∞‡§ö‡§æ‡§∞ (Special Promotion) --</p>
                        <div class="ad-placeholder-dynamic">
                            <!-- Ads will be rendered here by ads.js function call -->
                            <div style="min-height: 100px; color: #aaa;">‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
                        </div>
                    </div>
                `);
            }
        }
        // --- END AD INJECTION LOGIC ---

        const htmlContent = contentArray.join('');
        
        if (!loadMore) {
            listElement.innerHTML = `<h3>Available Services (${itemsToRender.length} loaded)</h3>` + htmlContent;
            
            // ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§¨‡•â‡§ü‡§Æ ‡§è‡§° ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à
        } else {
            listElement.insertAdjacentHTML('beforeend', htmlContent);
        }
        
        // --- AD LOADER CALL ---
        // ‡§∞‡•á‡§Ç‡§°‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§¨‡§æ‡§¶, ‡§°‡§æ‡§Ø‡§®‡•á‡§Æ‡§ø‡§ï‡§≤‡•Ä ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§ø‡§è ‡§ó‡§è ‡§è‡§°‡•ç‡§∏ ‡§ï‡•ã ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        if (typeof window.loadInjectedPromotionAds === 'function') {
            window.loadInjectedPromotionAds(); 
        }

        if (snapshotSize > providersLimit) {
            loadMoreBtn.style.display = 'block';
            loadMoreBtn.onclick = () => loadCategories(true);
        } else {
            loadMoreBtn.style.display = 'none';
            listElement.insertAdjacentHTML('beforeend', '<p style="text-align:center;color:green;font-weight:bold;">‚úÖ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§ ‡§Ö‡§¨ ‡§î‡§∞ ‡§ï‡•ã‡§à ‡§®‡§Ø‡§æ ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!</p>');
        }

    }, (error) => {
        console.error("Error loading services:", error);
        document.getElementById('loading-more')?.remove();
        listElement.innerHTML = '<h3>Available Services</h3><p style="text-align:center;color:red;">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à‡•§</p>';
    });
} // window.loadCategories ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡§æ ‡§ï‡•ç‡§≤‡•ã‡§ú‡§ø‡§Ç‡§ó ‡§¨‡•ç‡§∞‡•à‡§ï‡•á‡§ü

// ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞‡•ç‡§° ‡§≤‡•ã‡§ï‡§≤ ‡§ê‡§∞‡•á ‡§∏‡•á ‡§™‡•á‡§ú ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç (Ads injected)
function renderFilteredPage(listElement, loadMoreBtn, isLoadMore = false) {
    const providersLimit = 10;
    const start = filteredPageIndex * providersLimit;
    const end = start + providersLimit;
    const itemsToRender = filteredProviders.slice(start, end);
    const totalItems = filteredProviders.length;
    const isLastPage = totalItems <= end;


    if (itemsToRender.length > 0) {
// --- AD INJECTION LOGIC (Filtered List - Every 4 Cards) ---
        let contentArray = [];
        const adInjectionInterval = 4; // ‡§π‡§∞ 4 ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§è‡§° ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å

        for(let i=0; i < itemsToRender.length; i++){
            // 1. ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
            contentArray.push(window.renderProviderCard(itemsToRender[i]));
            
            // 2. ‡§è‡§° ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§π‡§∞ 4 ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡•á ‡§¨‡§æ‡§¶)
            if ((i + 1) % adInjectionInterval === 0 && (i + 1) < itemsToRender.length) {
                contentArray.push(`
                    <!-- **PROMOTION AD INJECTION POINT (Filtered List)** -->
                    <div class="promotion-ad-block" 
                         style="text-align: center; margin: 30px 0; padding: 10px; border: 1px dashed #ffc107; border-radius: 8px; background-color: #fff8e1;">
                        <p style="font-size: 0.9em; color: #ff9800; font-weight: bold; margin-bottom: 10px;">-- ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§™‡•ç‡§∞‡§ö‡§æ‡§∞ (Special Promotion) --</p>
                        <div class="ad-placeholder-dynamic">
                            <!-- Ads will be rendered here by ads.js function call -->
                            <div style="min-height: 100px; color: #aaa;">‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
                        </div>
                    </div>
                `);
            }
        }
        // --- END AD INJECTION LOGIC ---

        const htmlContent = contentArray.join('');
    
        if (!isLoadMore) {
            listElement.innerHTML = `<h3>Available Services (${currentCategory} - ${Math.min(end, totalItems)}/${totalItems} loaded)</h3>` + htmlContent;
        } else {
            listElement.insertAdjacentHTML('beforeend', htmlContent);
        }
        
        // --- AD LOADER CALL ---
        // ‡§∞‡•á‡§Ç‡§°‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§¨‡§æ‡§¶, ‡§°‡§æ‡§Ø‡§®‡•á‡§Æ‡§ø‡§ï‡§≤‡•Ä ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§ø‡§è ‡§ó‡§è ‡§è‡§°‡•ç‡§∏ ‡§ï‡•ã ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        if (typeof window.loadInjectedPromotionAds === 'function') {
            window.loadInjectedPromotionAds(); 
        }

        filteredPageIndex++; 
    } else if (!isLoadMore) {
         listElement.innerHTML = `<h3>Available Services (${currentCategory})</h3><p style="text-align:center;color:#ff6666;">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!</p>`;
    }
    
    if (totalItems > filteredPageIndex * providersLimit) {
        loadMoreBtn.style.display = 'block';
        loadMoreBtn.onclick = () => filterByCategory(currentCategory, true);
    } else {
        loadMoreBtn.style.display = 'none';
        listElement.insertAdjacentHTML('beforeend', '<p style="text-align:center;color:green;font-weight:bold;">‚úÖ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§</p>');
        
        // Bottom Ad ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à
    }
                }

    // ‚≠ê 2. ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç 
    window.filterByCategory = (category, loadMore = false) => {
        const listElement = document.getElementById('mistri-list');
        const loadMoreBtn = document.getElementById('load-more-providers');
        loadMoreBtn.style.display = 'none';
        
        providersLastTimestamp = null;
        providersLastKey = null;
        
        document.querySelectorAll('.cat-btn').forEach(btn => {
            btn.classList.remove('selected');
            if(btn.innerText === category) {
                btn.classList.add('selected');
            }
        });

        if (!loadMore) {
            currentCategory = category;
            filteredPageIndex = 0;
            listElement.innerHTML = `<h3>Available Services (${category})</h3><p style="text-align:center;color:#2a5298;">${category} ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à... (‡§™‡•Ç‡§∞‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§´‡•á‡§ö ‡§ï‡•Ä ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à)</p>`;

            window.providersRef.orderByChild('category').equalTo(category).once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    listElement.innerHTML = `<h3>Available Services (${category})</h3><p style="text-align:center;color:#ff6666;">‡§á‡§∏ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>`;
                    return;
                }

                filteredProviders = [];
                snapshot.forEach(childSnapshot => {
                    filteredProviders.push(childSnapshot.val());
                });

                filteredProviders.sort((a, b) => b.timestamp - a.timestamp);

                renderFilteredPage(listElement, loadMoreBtn);
            }, (error) => {
                console.error("Error loading filtered services:", error);
                listElement.innerHTML = '<p style="text-align:center;color:red;">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à‡•§</p>';
            });

        } else {
            listElement.insertAdjacentHTML('beforeend', '<p id="loading-more" style="text-align:center;color:#2a5298;">‡§î‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>');
            
            setTimeout(() => { 
                document.getElementById('loading-more')?.remove();
                renderFilteredPage(listElement, loadMoreBtn, true);
            }, 100);
        }
    };


    // ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§∞‡•ç‡§ö (Ads injected)
    window.searchServices = () => {
        const searchTerm = document.getElementById('main-search-bar').value.toLowerCase().trim();
        const listElement = document.getElementById('mistri-list');
        
        if (searchTerm.length < 3) {
            loadCategories(); 
            return;
        }

        listElement.innerHTML = `<h3>Search Results for "${searchTerm}"</h3><p style="text-align:center;color:#2a5298;">‡§ñ‡•ã‡§ú ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...</p>`;
        document.getElementById('load-more-providers').style.display = 'none'; 
        
        window.providersRef.once('value', (snapshot) => { 
            const providers = snapshot.val();
            let results = [];
            if (providers) {
                results = Object.values(providers).filter(p => 
                    (p.name && p.name.toLowerCase().includes(searchTerm)) || 
                    (p.category && p.category.toLowerCase().includes(searchTerm)) ||
                    (p.area && p.area.toLowerCase().includes(searchTerm))
                );
                
                results.sort((a, b) => b.timestamp - a.timestamp);
            }
            
            // --- AD INJECTION LOGIC (Search Results) ---
            let contentArray = [];
            for (let i = 0; i < results.length; i++) {
                contentArray.push(renderProviderCard(results[i]));
                if (i === 4 && results.length > 5) { // Inject middle ad after 5th item
                    contentArray.push(renderAdCard('search-ad-middle', 'üåü ‡§Ü‡§™‡§ï‡•á ‡§è‡§∞‡§ø‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ ‡§ë‡§´‡§º‡§∞! (Search Middle Ad)'));
                }
            }
            
            let html = `<h3>Search Results for "${searchTerm}" (${results.length} found)</h3>`;
            if (results.length > 0) {
                html += contentArray.join('');
                // Inject bottom ad
                html += renderAdCard('search-ad-bottom', '‚¨áÔ∏è ‡§´‡§§‡•á‡§π‡§™‡•Å‡§∞ ‡§ï‡•á ‡§ü‡•â‡§™ ‡§°‡•Ä‡§≤‡•ç‡§∏ ‡§Ø‡§π‡§æ‡§Å ‡§¶‡•á‡§ñ‡•á‡§Ç ‚¨áÔ∏è (Search Bottom Ad)');
            } else {
                html += '<p style="text-align:center;color:#ff6666;">‡§Ü‡§™‡§ï‡•Ä ‡§ñ‡•ã‡§ú ‡§∏‡•á ‡§Æ‡•á‡§≤ ‡§ñ‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ï‡•ã‡§à ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§</p>';
            }
            listElement.innerHTML = html;
            // --- END AD INJECTION LOGIC ---
        });
    };
    
    // ‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    window.logOut = () => {
        firebase.auth().signOut().then(() => {
            console.log("User signed out successfully.");
            location.reload(); // ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§™‡•á‡§ú ‡§∞‡•Ä‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        }).catch((error) => {
            console.error("Sign Out Error:", error);
            alert("Sign Out ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§");
        });
    }

    // ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§≤‡§ø‡§∏‡§®‡§∞ ‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    window.startFirebaseListener = () => {
        loadCategories(); 
        renderCategoryButtons(); 
    }

    // WHATSAPP ‡§¨‡§ü‡§® ‡§´‡§º‡§ø‡§ï‡•ç‡§∏
    function openWhatsApp(phone) {
        let num = phone.toString().replace(/[^0-9]/g, '');
        if (num.length === 10) num = '91' + num;
        if (num.length === 12 && num.startsWith('91')) {
        } else if (num.length === 13 && num.startsWith('919')) {
            num = num.substring(1);
        }
        window.open('https://wa.me/' + num, '_blank');
    }

    // =======================================================
// 1. ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® (registerService()) - CORRECTED
// =======================================================
function registerService() {
    try {
        const user = firebase.auth().currentUser;

        if (!user) {
            alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á OTP ‡§∏‡•á ‡§≤‡•â‡§ó-‡§á‡§® ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ø‡§π ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à‡•§'); 
            return false;
        }

        const userId = user.uid; 
        
        // ‚úÖ CORRECTED IDs - Index.html ‡§ï‡•á according
        const name = document.getElementById('providerName').value;
        const phone = document.getElementById('providerPhone').value;
        const category = document.getElementById('serviceCategory').value; // ‚úÖ FIXED
        const area = document.getElementById('providerArea').value;
        const experience = document.getElementById('providerExperience').value;
        
        // ‡§µ‡•à‡§≤‡§ø‡§°‡•á‡§∂‡§® ‡§ö‡•á‡§ï
        if (!name || !phone || !category || !area || !experience || phone.length !== 10 || isNaN(phone)) {
            alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç, ‡§î‡§∞ ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§π‡•ã‡•§");
            return false;
        }

        // ‡§°‡•Å‡§™‡•ç‡§≤‡•Ä‡§ï‡•á‡§ü ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§ö‡•á‡§ï
        window.providersRef.orderByChild('phone').equalTo(phone).once('value', snapshot => {
            if (snapshot.exists()) {
                alert('‚ùå ‡§Ø‡§π ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•à! ‡§°‡•Å‡§™‡•ç‡§≤‡•Ä‡§ï‡•á‡§ü ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§');
                return; 
            }

            // ‡§°‡•á‡§ü‡§æ ‡§ë‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§°‡§ø‡§´‡§æ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç
            const providerData = { 
                name: name,
                phone: phone,
                category: category,
                area: area,
                experience: experience,
                userId: userId, // Edit/Delete ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };
            
            window.providersRef.push(providerData)
            .then(() => {
                alert('‚úÖ ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•ã ‡§ó‡§à ‡§π‡•à! ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§'); 
                
                // ‡•û‡•â‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                const form = document.getElementById('serviceForm');
                if (form) form.reset();
            })
            .catch((error) => {
                console.error("‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø (Firebase): ", error);
                alert('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§´‡§º‡•á‡§≤ ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§ ' + error.message); 
            });

        })
        .catch(error => {
            console.error("Firebase Read Error during duplicate check:", error);
            alert("‡§Æ‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç, ‡§°‡•á‡§ü‡§æ ‡§ö‡•á‡§ï ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§Ü‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§");
        });

    } catch (e) {
        console.error("‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§ï‡•ç‡§∞‡§ø‡§ü‡§ø‡§ï‡§≤ ‡§´‡§º‡•á‡§≤‡§ø‡§Ø‡§∞: ", e);
        alert("‡§Æ‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç, ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§Ü‡§Ç‡§§‡§∞‡§ø‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§Ü‡§à‡•§");
    }

    return false;
    }

// =======================================================
// 2. ‡§ú‡•â‡§¨ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® (registerJob()) - ‡§´‡§æ‡§á‡§®‡§≤ ‡§´‡§ø‡§ï‡•ç‡§∏ (Reset Fix)
// =======================================================
function registerJob() {
    event.preventDefault();
    
    const user = firebase.auth().currentUser;

    if (!user) {
        alert('‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§Ü‡§™‡§ï‡•ã ‡§≤‡•â‡§ó-‡§á‡§® ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ‡•§'); 
        return false; 
    }

    const posterId = user.uid; 
    
    // ‡§´‡§º‡•â‡§∞‡•ç‡§Æ ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§á‡§ï‡§ü‡•ç‡§†‡§æ ‡§ï‡§∞‡•á‡§Ç
    const title = document.getElementById('jobTitle').value;
    const shopName = document.getElementById('jobShopName').value;
    const location = document.getElementById('jobLocation').value;
    const salary = document.getElementById('jobSalary').value;
    const phone = document.getElementById('jobPhone').value;
    const description = document.getElementById('jobDescription').value;

    // ‡§µ‡•à‡§≤‡§ø‡§°‡•á‡§∂‡§® ‡§ö‡•á‡§ï
    if (!title || !shopName || !location || !salary || !phone || !description || phone.length !== 10 || isNaN(phone)) {
        alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§π‡•ã‡•§");
        return false;
    }
    
    const jobData = {
        title: title, 
        shopName: shopName, 
        location: location,
        salary: salary,
        phone: phone,
        description: description,
        posterId: posterId,
        timestamp: firebase.database.ServerValue.TIMESTAMP
    };

    window.jobsRef.push(jobData)
    .then(() => {
        alert('‚úÖ ‡§ú‡•â‡§¨ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ã‡§∏‡•ç‡§ü ‡§π‡•ã ‡§ó‡§à!'); 
        
        // ‚úÖ SIMPLE FORM RESET
        document.getElementById('jobForm').reset();
    })
    .catch((error) => {
        console.error("Job Error:", error);
        alert('‚ùå ‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§Ü‡§à‡•§');
    });

    return false;
        }
        
    window.onload = () => {
        firebase.initializeApp(firebaseConfig);
        window.database = firebase.database();
        window.providersRef = database.ref('service_providers'); 
        window.jobsRef = database.ref('local_jobs'); 

        // 1. ‡§Ö‡§¶‡•É‡§∂‡•ç‡§Ø reCAPTCHA ‡§∏‡•á‡§ü‡§Ö‡§™
        recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
            'size': 'invisible'
        });
        recaptchaVerifier.render();

        // 2. ‡§™‡§∞‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§∏ ‡§ö‡•á‡§ï: ‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§ë‡§•‡•á‡§Ç‡§ü‡§ø‡§ï‡•á‡§∂‡§® ‡§∏‡•ç‡§ü‡•á‡§ü ‡§≤‡§ø‡§∏‡§®‡§∞
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById('registrationScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                console.log("Auto-Login Successful:", user.phoneNumber);

                startFirebaseListener();
                
            } else {
                document.getElementById('registrationScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        });


        // 3. ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§: OTP ‡§≠‡•á‡§ú‡•á‡§Ç (‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡•ç‡§ü‡•á‡§™ 1) - ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§Ü‡§ï‡•ç‡§∞‡§æ‡§Æ‡§ï ‡§è‡§∞‡§∞ ‡§°‡§æ‡§Ø‡§ó‡•ç‡§®‡•ã‡§∏‡•ç‡§ü‡§ø‡§ï‡•ç‡§∏ ‡§π‡•à‡§Ç‡•§
        document.getElementById('sendOtpBtn').onclick = () => {
            const name = document.getElementById('userName').value.trim();
            const area = document.getElementById('userArea').value.trim();
            const phone = document.getElementById('phoneInput').value.trim();
            
            if (!name || !area || phone.length !== 10 || isNaN(phone)) {
                document.getElementById('loginMsg').innerHTML = "<span style='color:red'>‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° (‡§®‡§æ‡§Æ, ‡§è‡§∞‡§ø‡§Ø‡§æ) ‡§≠‡§∞‡•á‡§Ç ‡§î‡§∞ 10 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç‡•§</span>";
                return;
            }

            tempUserData = {
                name: name,
                area: area,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            document.getElementById('sendOtpBtn').innerHTML = "Sending...";
            const fullPhone = '+91' + phone;
            document.getElementById('loginMsg').innerHTML = "<span style='color:orange'>OTP ‡§≠‡•á‡§ú‡§®‡•á ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...</span>";

            // ‡§®‡§Ø‡§æ OTP ‡§≠‡•á‡§ú‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§ï‡•ã ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§´‡§º‡§ø‡§ï‡•ç‡§∏)
            firebase.auth().signOut()
                .then(() => initiateOtpFlow(fullPhone))
                .catch(() => initiateOtpFlow(fullPhone)); 

            function initiateOtpFlow(fullPhone) {
                console.log("Attempting reCAPTCHA verification for:", fullPhone);
                recaptchaVerifier.verify().then(() => {
                    console.log("reCAPTCHA Verified. Sending SMS now...");
                    document.getElementById('loginMsg').innerHTML = `<span style='color:#2a5298'>‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ú‡§æ‡§Å‡§ö ‡§™‡•Ç‡§∞‡•Ä ‡§π‡•Å‡§à‡•§ ${fullPhone} ‡§™‡§∞ OTP ‡§≠‡•á‡§ú‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...</span>`;

                    firebase.auth().signInWithPhoneNumber(fullPhone, recaptchaVerifier)
                        .then((result) => {
                            confirmationResult = result;
                            document.getElementById('profileInputSection').style.display = 'none'; 
                            document.getElementById('otpSection').style.display = 'block'; 
                            document.getElementById('loginMsg').innerHTML = `<span style='color:green'>‚úÖ OTP ${fullPhone} ‡§™‡§∞ ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ!</span>`;
                        })
                        .catch((err) => {
                            // ‚≠ê OTP Failures often land here (Error Diagnostics)
                            console.error("Firebase SMS Send Error:", err.code, err.message);
                            document.getElementById('loginMsg').innerHTML = `<span style='color:red'>‚ùå OTP ‡§≠‡•á‡§ú‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§à: ${err.message} (‡§ï‡•ã‡§°: ${err.code}). ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§ï‡•Å‡§õ ‡§¶‡•á‡§∞ ‡§á‡§Ç‡§§‡§ú‡§º‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§</span>`;
                            document.getElementById('sendOtpBtn').innerHTML = "Send OTP & Sign Up";
                            document.getElementById('profileInputSection').style.display = 'block';
                            document.getElementById('otpSection').style.display = 'none';
                            // reCAPTCHA ‡§ï‡•ã ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§Ø‡§π ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á
                            recaptchaVerifier.clear();
                        });
                }).catch((err) => {
                    // ‚≠ê reCAPTCHA failures land here (Error Diagnostics)
                    console.error("reCAPTCHA Verification Error:", err.message);
                    document.getElementById('loginMsg').innerHTML = `<span style='color:red'>‚ùå reCAPTCHA ‡§ú‡§æ‡§Å‡§ö ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞: ${err.message}. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•á‡§ú ‡§∞‡•Ä‡§≤‡•ã‡§° ‡§ï‡§∞‡§ï‡•á ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§</span>`;
                    document.getElementById('sendOtpBtn').innerHTML = "Send OTP & Sign Up";
                });
            }
        };


        // 4. OTP ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç (‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡•ç‡§ü‡•á‡§™ 2) - ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø
        document.getElementById('verifyOtpBtn').onclick = () => {
            const otp = document.getElementById('otpInput').value;
            if (otp.length !== 6) {
                document.getElementById('loginMsg').innerHTML = "<span style='color:red'>‡§ï‡•É‡§™‡§Ø‡§æ 6 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ OTP ‡§°‡§æ‡§≤‡•á‡§Ç‡•§</span>";
                return;
            }
            
            document.getElementById('loginMsg').innerHTML = "<span style='color:orange'>‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...</span>";


            confirmationResult.confirm(otp)
                .then((result) => {
                    const user = result.user;
                    if (user && user.uid) {
                        window.database.ref('users/' + user.uid).set(tempUserData)
                            .then(() => {
                                document.getElementById('loginMsg').innerHTML = "<span style='color:green'>‚úÖ Login Successful! Redirecting...</span>";
                                // ‚≠ê CRITICAL FIX: ‡§∏‡§´‡§≤ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§∞‡§ø‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
                                location.reload(); 
                            })
                            .catch(error => {
                                console.error("Profile save error:", error);
                                document.getElementById('loginMsg').innerHTML = "<span style='color:red'>Login Successful, but profile save failed. Please contact support.</span>";
                            });
                    } else {
                        document.getElementById('loginMsg').innerHTML = "<span style='color:red'>Verification Failed: User not returned.</span>";
                    }
                })
                .catch(() => {
                    document.getElementById('loginMsg').innerHTML = "<span style='color:red'>‚ùå ‡§ó‡§º‡§≤‡§§ OTP! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä 6 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ OTP ‡§°‡§æ‡§≤‡•á‡§Ç‡•§</span>";
                });
        };

        // ‡§è‡§ï‡•ç‡§∏‡•ç‡§ü‡•ç‡§∞‡§æ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
        window.contactForAds = () => window.open('https://wa.me/919889904191?text=Hello! Main apne business ka ad lagwana chahta hoon Fatehpur Hubs pe', '_blank');
        window.shareApp = () => navigator.share ? navigator.share({title: 'Fatehpur Hubs', text: 'Best local services app', url: 'https://www.fatehpurhubs.co.in'}) : alert('Share link: https://www.fatehpurhubs.co.in');
        window.showScreen = (id) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            // ‡§ï‡•á‡§µ‡§≤ ‡§§‡§≠‡•Ä ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç ‡§ú‡§¨ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á
            if(id === 'jobs-screen') loadJobs();
            if(id === 'home-screen') loadCategories(); 
        };
        // PWA ‡§∏‡•á‡§ü‡§Ö‡§™
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // service worker registration logic goes here
            });
        }
    };
    </script>
    <script type="text/javascript" src="ads.js"></script>
<script>
    // Service Worker Registration (‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™‡§ï‡•Ä PWA ‡§†‡•Ä‡§ï ‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á)
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                })
                .catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
        });
    }
    
</script>
                
            
<!-- BOTTOM ADS & NAV BAR - EXACTLY LIKE MIDDLE ADS -->
<div style="position:fixed; bottom:50px; left:0; right:0; z-index:9998; padding:0;">
    <div style="width:100%; max-width:500px; margin:0 auto;">
        <div class="ad-container" style="width:320px; height:50px; margin:0 auto; text-align:center;">
            <!-- Ad Script: EXACTLY like middle ads -->
            <script type="text/javascript">
                atOptions = {
                    'key' : '969a80a2e6bea9f00173f36024f32cb2',
                    'format' : 'iframe',
                    'height' : 50,
                    'width' : 320,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/969a80a2e6bea9f00173f36024f32cb2/invoke.js"></script>
        </div>
    </div>
</div>

<div style="position:fixed; bottom:0; left:0; right:0; background:#2c3e50; z-index:9999; padding:0;">
    <div style="width:100%; max-width:500px; margin:0 auto; display:flex; justify-content:space-around;">
        <div style="text-align:center; color:white; font-size:12px; flex:1; cursor:pointer; padding:8px 0;" onclick="showScreen('home-screen')">
            <div style="font-size:18px; margin-bottom:2px;">üè†</div>
            <div>‡§π‡•ã‡§Æ</div>
        </div>
        <div style="text-align:center; color:white; font-size:12px; flex:1; cursor:pointer; padding:8px 0;" onclick="showScreen('add-service-screen')">
            <div style="font-size:18px; margin-bottom:2px;">üîß</div>
            <div>‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏</div>
        </div>
        <div style="text-align:center; color:white; font-size:12px; flex:1; cursor:pointer; padding:8px 0;" onclick="showScreen('jobs-screen')">
            <div style="font-size:18px; margin-bottom:2px;">üíº</div>
            <div>‡§®‡•å‡§ï‡§∞‡§ø‡§Ø‡§æ‡§Å</div>
        </div>
        <div style="text-align:center; color:white; font-size:12px; flex:1; cursor:pointer; padding:8px 0;" onclick="showScreen('share-screen')">
            <div style="font-size:18px; margin-bottom:2px;">üì§</div>
            <div>‡§∂‡•á‡§Ø‡§∞</div>
        </div>
    </div>
</div>

</body>
</html>
