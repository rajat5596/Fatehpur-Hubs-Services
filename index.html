<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fatehpur Hubs</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ff6666">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
        body { background: #f5f5f5; }
        .container { max-width: 400px; margin: 0 auto; background: white; min-height: 100vh; }
        header { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .screen { display: none; padding: 15px; }
        .screen.active { display: block; }
        #main-search-bar { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 25px; margin: 10px 0 20px 0; }
        .categories-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .cat-btn { background: white; border: 2px solid #e0e0e0; padding: 12px 8px; border-radius: 10px; cursor: pointer; }
        .cat-btn.selected { background: #2a5298; color: white; border-color: #2a5298; }
        .profile-card { background: white; border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        .contact-btn { background: #2a5298; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; }
        .whatsapp-btn { background: #25D366; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; }
        .share-btn-inline { background: #f8f9fa; color: #333; border: 1px solid #e0e0e0; padding: 8px 15px; border-radius: 20px; cursor: pointer; }
        .footer { position: fixed; bottom: 0; width: 100%; max-width: 400px; background: white; padding: 10px 15px; display: flex; justify-content: space-between; border-top: 1px solid #e0e0e0; }
        .premium-btn { background: #ffd700; color: #333; padding: 8px 15px; border-radius: 20px; text-decoration: none; }
        .ad-container { margin: 15px 0; text-align: center; background: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px solid #e0e0e0; }
        .promotion-section { margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #ff9a9e, #fad0c4); border-radius: 10px; text-align: center; }
        .contact-ads-section { margin: 20px 0; padding: 15px; background: #e6e6fa; border-radius: 10px; text-align: center; border: 2px solid #8a2be2; }
    </style>
</head>
    <body>  
    <!-- Top Ad -->
    <div class="ad-container">
        <div class="ad-label">Advertisement</div>
        <script type="text/javascript">
            atOptions = { 'key' : '969a80a2e6bea9f00173f36024f32cb2', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/969a80a2e6bea9f00173f36024f32cb2/invoke.js"></script>
    </div>

    <div class="container">
        <header>
            <h1><img src="https://firebasestorage.googleapis.com/v0/b/fatehpur-hubs.firebasestorage.app/o/file_0000000059806208b25eb7951e979b96.png?alt=media&token=61e97884-5882-4055-b45f-4303a0d6d818" alt="" style="height: 50px; width: auto;"> <span>Fatehpur Hubs</span></h1>
            <div id="auth-info">Fatehpur ke Professional Services</div>
        </header>
        
        <div id="home-screen" class="screen active">
            <input type="text" id="main-search-bar" placeholder="üîç Search Plumber, Electrician...">
            
            <!-- Middle Ad -->
            <div class="ad-container">
                <div class="ad-label">Sponsored</div>
                <script type="text/javascript">
                    atOptions = { 'key' : 'd65603602583bbe6bc3308e8ee8ab792', 'format' : 'iframe', 'height' : 250, 'width' : 300, 'params' : {} };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/d65603602583bbe6bc3308e8ee8ab792/invoke.js"></script>
            </div>
            <h3>üöÄ Popular Services</h3>
            <div id="mistri-categories" class="categories-list">
                <button class="cat-btn" data-cat="Plumber">üíß Plumber</button>
                <button class="cat-btn" data-cat="Electrician">‚ö° Electrician</button>
                <button class="cat-btn" data-cat="Carpenter">üî® Carpenter</button>
                <button class="cat-btn" data-cat="Mason">üß± Mason</button>
                <button class="cat-btn" data-cat="Painter">üé® Painter</button>
                <button class="cat-btn" data-cat="AC Mechanic">‚ùÑÔ∏è AC Mech.</button>
                <button class="cat-btn" data-cat="Tiler">‚óªÔ∏è Tiler</button>
                <button id="more-cat-btn" class="cat-btn" onclick="showScreen('search-screen')">More...</button>
            </div>

            <div class="promotion-section" style="padding: 10px; background-color: #f7f7f7; border-radius: 8px; margin-bottom: 15px;">
                <h3 style="text-align: center; font-size: 1.1em; color: #333; margin-top: 0;">‚ú® Special Offers & Promotions ‚ú®</h3> 
                <div id="promotion-banner-area" style="min-height: 100px; padding-top: 5px;"></div>
            </div>
            <div id="service-registration" style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; color: white;">
                <h3 style="color: white; text-align: center;">‚ûï Add Your Service</h3>
                <form id="serviceForm">
                    <input type="text" id="providerName" placeholder="Your Name" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                    <input type="tel" id="providerPhone" placeholder="Phone Number" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                    <select id="serviceCategory" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                        <option value="">Select Service</option>
                        <option>Plumber</option><option>Electrician</option><option>Carpenter</option><option>Mason</option>
                        <option>Painter</option><option>AC Mechanic</option><option>Tiler</option><option>TV Mechanic</option>
                        <option>Welder</option><option>Computer Repair</option>
                    </select>
                    <input type="text" id="providerArea" placeholder="Your Area" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                    <input type="text" id="providerExperience" placeholder="Experience" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                    <button type="submit" id="registerBtn" style="width: 100%; background: #25D366; color: white; padding: 12px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;">Register Service</button>
                </form>
            </div>

            <!-- CONTACT FOR ADS SECTION -->
            <div class="contact-ads-section">
                <h4 style="color: #4b0082; margin-bottom: 5px; font-size: 1.1em;">üì¢ Want to Promote Your Business?</h4>
                <p style="color: #333; font-size: 0.9em; margin-bottom: 15px;">Show your ad to thousands of users in Fatehpur!<br>Contact us for advertising space.</p>
                <button onclick="contactForAds()" style="background: #8a2be2; color: white; padding: 10px 20px; border: none; border-radius: 25px; font-size: 1em; font-weight: bold; cursor: pointer;">üìû Contact for Advertising</button>
                <p style="font-size: 12px; margin-top: 10px; color: #666;">WhatsApp: 9889904191</p>
            </div>
            
            <div id="mistri-list">
                <h3>Available Services</h3>
                <p style="text-align: center; color: #2a5298;">Loading services...</p>
            </div> 
            
            <div style="height: 80px;"></div>
        </div>

        <!-- SEARCH SCREEN -->
        <div id="search-screen" class="screen">
            <button class="back-btn" onclick="showScreen('home-screen')" style="background: #f8f9fa; border: 1px solid #ccc; padding: 8px 15px; border-radius: 5px; margin-bottom: 15px; cursor: pointer;">‚Üê Back</button>
            <h2>All Services</h2>
            <div id="all-categories-list" class="categories-list"></div> 
            <div id="mistri-list-full"></div>
        </div>
        <!-- JOBS SCREEN -->
        <div id="jobs-screen" class="screen">
            <button class="back-btn" onclick="showScreen('home-screen')" style="background: #f8f9fa; border: 1px solid #ccc; padding: 8px 15px; border-radius: 5px; margin-bottom: 15px; cursor: pointer;">‚Üê Back</button>
            <h2>üè¢ Local Jobs</h2>
            
            <!-- Job Posting Form -->
            <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; color: white;">
                <h3 style="color: white; text-align: center;">‚ûï Post a Job</h3>
                <form id="jobForm">
                    <input type="text" id="jobTitle" placeholder="Job Title (e.g., Sales Girl, Helper)" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                    <input type="text" id="shopName" placeholder="Shop/Business Name" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                    <input type="tel" id="jobPhone" placeholder="Phone Number" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                    <input type="text" id="jobLocation" placeholder="Location/Area" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                    <input type="text" id="jobSalary" placeholder="Salary (e.g., ‚Çπ8000/month)" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                    <select id="jobType" style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px;">
                        <option value="full-time">Full Time</option>
                        <option value="part-time">Part Time</option>
                    </select>
                    <textarea id="jobDescription" placeholder="Job Description (e.g., Required for clothing shop, timing 10AM-7PM)" required style="width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; font-size: 16px; height: 80px;"></textarea>
                    <button type="submit" id="postJobBtn" style="width: 100%; background: #25D366; color: white; padding: 12px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;">Post Job</button>
                </form>
            </div>
            
            <!-- Jobs List -->
            <div id="jobs-list">
                <p style="text-align: center; color: #2a5298;">Loading jobs...</p>
            </div>
        </div>

        <div class="footer">
            <a href="https://rzp.io/rzp/4kK9deS" target="_blank" class="premium-btn">‚≠ê Premium</a>
            <button class="share-btn-inline" onclick="shareApp()">üì§ Share App</button>
            <button class="share-btn-inline" onclick="openMoreApps()">‚ûï More</button>
        </div>
    </div>
    <!-- Jobs List -->
            <div id="jobs-list">
                <p style="text-align: center; color: #2a5298;">Loading jobs...</p>
            </div>
        </div>

        <div class="footer">
            <a href="https://rzp.io/rzp/4kK9deS" target="_blank" class="premium-btn">‚≠ê Premium</a>
            <button class="share-btn-inline" onclick="shareApp()">üì§ Share App</button>
            <button class="share-btn-inline" onclick="openMoreApps()">‚ûï More</button>
        </div>
    </div>

    <!-- Bottom Ad -->
    <div class="ad-container">
        <div class="ad-label">Advertisement</div>
        <script type="text/javascript">
            atOptions = { 'key' : '969a80a2e6bea9f00173f36024f32cb2', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/969a80a2e6bea9f00173f36024f32cb2/invoke.js"></script>
    </div>
    <!-- SCRIPTS -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="ads.js"></script>
        <script>
        // ‚úÖ FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyA37JsLUIG-kypZ55vdpLTp3WKHgRH2IwY",
            authDomain: "fatehpur-hubs-a3a9f.firebaseapp.com",
            databaseURL: "https://fatehpur-hubs-a3a9f-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "fatehpur-hubs-a3a9f",
            storageBucket: "fatehpur-hubs-a3a9f.firebasestorage.app",
            messagingSenderId: "294360741451",
            appId: "1:294360741451:web:3bc85078805750b9fabfce"
        };
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = app.database();
        const providersRef = database.ref('service_providers');
        window.providersRef = providersRef;

        // ‚úÖ GLOBAL VARIABLES
        let serviceProviders = [];
        const ALL_CATEGORIES = ['Plumber', 'Electrician', 'Carpenter', 'Mason', 'Painter', 'AC Mechanic', 'TV Mechanic', 'Tiler', 'Welder', 'Computer Repair'];

        // ‚úÖ PLAY STORE LINK (Yahan change karein jab app public hogi)
        const PLAY_STORE_LINK = "https://play.google.com/store/apps/details?id=com.fatehpurhubs.app";

        // ‚úÖ FIREBASE LISTENER
        function startFirebaseListener() {
            providersRef.on('value', (snapshot) => {
                serviceProviders = [];
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const provider = childSnapshot.val();
                        if (provider) serviceProviders.push(provider);
                    });
                    loadServiceProviders('mistri-list');
                } else {
                    document.getElementById('mistri-list').innerHTML = '<p style="text-align: center; color: #666;">No services registered yet.</p>';
                }
            });
        }

        // ‚úÖ LOAD SERVICES
        function loadServiceProviders(listId) {
            const mistriListDiv = document.getElementById(listId);
            if (!mistriListDiv) return;
            mistriListDiv.innerHTML = '<h3>Available Services</h3>';
            if (serviceProviders.length === 0) {
                mistriListDiv.innerHTML += '<p style="text-align: center; color: #666;">No services available.</p>';
                return;
            }
            serviceProviders.forEach(provider => {
                const card = document.createElement('div');
                card.className = 'profile-card';
                card.innerHTML = createProfessionalCard(provider);
                mistriListDiv.appendChild(card);
            });
        }
         // ‚úÖ LOAD SERVICES
        function loadServiceProviders(listId) {
            const mistriListDiv = document.getElementById(listId);
            if (!mistriListDiv) return;
            mistriListDiv.innerHTML = '<h3>Available Services</h3>';
            if (serviceProviders.length === 0) {
                mistriListDiv.innerHTML += '<p style="text-align: center; color: #666;">No services available.</p>';
                return;
            }
            serviceProviders.forEach(provider => {
                const card = document.createElement('div');
                card.className = 'profile-card';
                card.innerHTML = createProfessionalCard(provider);
                mistriListDiv.appendChild(card);
            });
        }

        // ‚úÖ CREATE CARD
        function createProfessionalCard(provider) {
            if (!provider) return '';
            const name = provider.name || 'No Name';
            const category = provider.category || 'Service';
            const area = provider.area || 'Area';
            const experience = provider.experience || 'Experience';
            const rating = provider.rating || '‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è';
            const phone = provider.phone || '';
            return `
                <div style="margin-bottom: 10px;">
                    <h4 style="margin: 0 0 5px 0; color: #2a5298;">${name}</h4>
                    <p style="margin: 2px 0; color: #666;">üìå ${category} | ${area}</p>
                    <p style="margin: 2px 0; color: #666;">‚è±Ô∏è ${experience}</p>
                    <p style="margin: 2px 0; color: #666;">${rating}</p>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 10px;">
                    <button class="contact-btn" onclick="callNumber('${phone}')">üìû Call</button>
                    <button class="whatsapp-btn" onclick="openWhatsApp('${phone}')">üí¨ WhatsApp</button>
                    <button class="share-btn-inline" onclick="shareProvider('${name}', '${category}', '${phone}')">üì§ Share</button>
                </div>
            `;
        }
// ‚úÖ REGISTER SERVICE WITH DUPLICATE CHECK
        function registerService() {
            const name = document.getElementById('providerName').value.trim();
            const phone = document.getElementById('providerPhone').value.trim();
            const category = document.getElementById('serviceCategory').value;
            const area = document.getElementById('providerArea').value.trim();
            const experience = document.getElementById('providerExperience').value.trim();
            
            if (!name || !phone || !category || !area || !experience) {
                alert('Please fill all fields'); 
                return false;
            }
            
            if (phone.length !== 10 || isNaN(phone)) {
                alert('Enter valid 10-digit phone number');
                return false;
            }
            
            const submitBtn = document.getElementById('registerBtn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Checking...';
            submitBtn.disabled = true;
            
            // ‚úÖ DUPLICATE CHECK - Same phone number already exists?
            providersRef.orderByChild('phone').equalTo(phone).once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        alert('‚ùå This phone number is already registered! One phone can register only once.');
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                        return;
                    }
                    
                    // ‚úÖ If not duplicate, register service
                    const newProvider = { 
                        name: name, 
                        category: category, 
                        phone: phone, 
                        area: area, 
                        experience: experience, 
                        rating: "‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è", 
                        timestamp: new Date().toISOString() 
                    };
                    
                    return providersRef.push(newProvider);
                })
                .then((result) => {
                    if (result) {
                        alert('‚úÖ Service Registered Successfully!');
                        document.getElementById('providerName').value = '';
                        document.getElementById('providerPhone').value = '';
                        document.getElementById('serviceCategory').value = '';
                        document.getElementById('providerArea').value = '';
                        document.getElementById('providerExperience').value = '';
                    }
                })
                .catch(error => {
                    alert('‚ùå Error: ' + error.message);
                })
                .finally(() => {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                });
            
            return false;
        }

        // ‚úÖ SHARE FUNCTIONS WITH PLAY STORE LINK
        function shareProvider(name, category, phone) {
            const message = `Check this ${category} service:\n\nüë®‚Äçüîß Name: ${name}\nüìû Phone: ${phone}\nüìç From: Fatehpur Hubs App\n\nDownload the app: ${PLAY_STORE_LINK}`;
            if (navigator.share) {
                navigator.share({ 
                    title: `${category} Service - Fatehpur Hubs`, 
                    text: message 
                });
            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            }
        }

        function shareApp() {
            const message = `Check out Fatehpur Hubs - Find all professional services in Fatehpur!\n\nDownload the app now: ${PLAY_STORE_LINK}`;
            if (navigator.share) {
                navigator.share({ 
                    title: 'Fatehpur Hubs', 
                    text: message 
                });
            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            }
        }

        // ‚úÖ CONTACT FUNCTIONS
        function callNumber(phone) { 
    // ‚úÖ CLEAN PHONE NUMBER - Remove +91, spaces, hyphens
    const cleanPhone = phone.replace(/[\s\-+]/g, '').replace(/^91/, '');
    if(cleanPhone.length === 10 && !isNaN(cleanPhone)) {
        window.location.href = `tel:+91${cleanPhone}`;
    } else {
        alert('Invalid phone number: ' + phone);
    }
}

function openWhatsApp(phone) { 
    // ‚úÖ CLEAN PHONE NUMBER - Remove +91, spaces, hyphens
    const cleanPhone = phone.replace(/[\s\-+]/g, '').replace(/^91/, '');
    if(cleanPhone.length === 10 && !isNaN(cleanPhone)) {
        const message = "Hello, I need your service from Fatehpur Hubs app.";
        window.open(`https://wa.me/91${cleanPhone}?text=${encodeURIComponent(message)}`, '_blank');
    } else {
        alert('Invalid phone number: ' + phone);
    }
}
        
        function contactForAds() {
            const message = "Hello, I'm interested in advertising my business on Fatehpur Hubs. Please share details about ad spaces, pricing, and duration.";
            window.open(`https://wa.me/919889904191?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }
        // ‚úÖ JOBS FUNCTIONS
                function openMoreApps() { 
            showScreen('jobs-screen');
            loadLocalJobs();
        }

        // ‚úÖ CATEGORY BUTTONS FIX - YEH FUNCTION ADD KAREIN
        function setupCategoryFilters() {
            document.querySelectorAll('#mistri-categories .cat-btn').forEach(button => {
                if(button.id !== 'more-cat-btn') {
                    button.addEventListener('click', function() {
                        // Remove selected class from all buttons
                        document.querySelectorAll('#mistri-categories .cat-btn').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                        
                        // Add selected class to clicked button
                        this.classList.add('selected');
                        
                        // Get category
                        const category = this.getAttribute('data-cat');
                        const mistriListDiv = document.getElementById('mistri-list');
                        
                        if (!mistriListDiv) return;
                        
                        // Filter services
                        mistriListDiv.innerHTML = `<h3>${category} Services</h3>`;
                        const filtered = serviceProviders.filter(p => p && p.category === category);
                        
                        if (filtered.length === 0) {
                            mistriListDiv.innerHTML += '<p style="text-align: center; color: #666;">No services found in this category.</p>';
                            return;
                        }

                        // Show filtered services
                        filtered.forEach(provider => {
                            const card = document.createElement('div');
                            card.className = 'profile-card';
                            card.innerHTML = createProfessionalCard(provider);
                            mistriListDiv.appendChild(card);
                        });
                    });
                }
            });
        }
        // ‚úÖ LOAD ALL CATEGORIES (For Search Screen)
        function loadAllCategories() {}

        function postJob() {
            const jobTitle = document.getElementById('jobTitle').value.trim();
            const shopName = document.getElementById('shopName').value.trim();
            const jobPhone = document.getElementById('jobPhone').value.trim();
            const jobLocation = document.getElementById('jobLocation').value.trim();
            const jobSalary = document.getElementById('jobSalary').value.trim();
            const jobDescription = document.getElementById('jobDescription').value.trim();
            const jobType = document.getElementById('jobType').value;
            
            if (!jobTitle || !shopName || !jobPhone || !jobLocation || !jobSalary || !jobDescription) {
                alert('Please fill all fields');
                return false;
            }
            
            if (jobPhone.length !== 10 || isNaN(jobPhone)) {
                alert('Enter valid 10-digit phone number');
                return false;
            }
            
            const submitBtn = document.getElementById('postJobBtn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Posting...';
            submitBtn.disabled = true;
            
            const newJob = {
                title: jobTitle,
                shopName: shopName,
                phone: jobPhone,
                location: jobLocation,
                salary: jobSalary,
                description: jobDescription,
                type: jobType,
                timestamp: new Date().toISOString()
            };
            
            const jobsRef = database.ref('local_jobs');
            jobsRef.push(newJob)
                .then(() => {
                    alert('‚úÖ Job Posted Successfully!');
                    // Clear form
                    document.getElementById('jobTitle').value = '';
                    document.getElementById('shopName').value = '';
                    document.getElementById('jobPhone').value = '';
                    document.getElementById('jobLocation').value = '';
                    document.getElementById('jobSalary').value = '';
                    document.getElementById('jobDescription').value = '';
                    document.getElementById('jobType').value = 'full-time';
                    
                    // Refresh jobs list
                    loadLocalJobs();
                })
                .catch(error => {
                    alert('‚ùå Error: ' + error.message);
                })
                .finally(() => {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                });
        }

        function loadLocalJobs() {
            const jobsRef = database.ref('local_jobs');
            const jobsListDiv = document.getElementById('jobs-list');
            
            jobsRef.on('value', (snapshot) => {
                jobsListDiv.innerHTML = '<h3>üè¢ Local Jobs</h3>';
                
                if (!snapshot.exists()) {
                    jobsListDiv.innerHTML += '<p style="text-align: center; color: #666;">No jobs posted yet. Be the first to post a job!</p>';
                    return;
                }
                
                snapshot.forEach((childSnapshot) => {
                    const job = childSnapshot.val();
                    const jobCard = document.createElement('div');
                    jobCard.className = 'profile-card';
                    jobCard.innerHTML = `
                        <div style="margin-bottom: 10px;">
                            <h4 style="margin: 0 0 5px 0; color: #2a5298;">${job.title}</h4>
                            <p style="margin: 2px 0; color: #666;">üè™ ${job.shopName}</p>
                            <p style="margin: 2px 0; color: #666;">üìç ${job.location}</p>
                            <p style="margin: 2px 0; color: #666;">üí∞ ${job.salary}</p>
                            <p style="margin: 2px 0; color: #666;">${job.type === 'full-time' ? '‚è∞ Full Time' : '‚è±Ô∏è Part Time'}</p>
                            <p style="margin: 2px 0; color: #666;">${job.description}</p>
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            <button class="contact-btn" onclick="callNumber('${job.phone}')">üìû Call</button>
                            <button class="whatsapp-btn" onclick="openJobWhatsApp('${job.phone}', '${job.title}', '${job.shopName}')">üí¨ Apply</button>
                            <button class="share-btn-inline" onclick="shareJob('${job.title}', '${job.shopName}', '${job.phone}')">üì§ Share</button>
                        </div>
                    `;
                    jobsListDiv.appendChild(jobCard);
                });
            });
        }

        function openJobWhatsApp(phone, jobTitle, shopName) {
            if(phone && phone.length === 10) {
                const message = `Hello, I'm interested in the ${jobTitle} position at ${shopName}. I found this job on Fatehpur Hubs app.`;
                window.open(`https://wa.me/91${phone}?text=${encodeURIComponent(message)}`, '_blank');
            }
        }

        function shareJob(jobTitle, shopName, phone) {
            const message = `Job Opportunity in Fatehpur!\n\nüè¢ ${shopName}\nüìã ${jobTitle}\nüìû ${phone}\n\nDownload Fatehpur Hubs App: ${PLAY_STORE_LINK}`;
            if (navigator.share) {
                navigator.share({ 
                    title: 'Job Opportunity - Fatehpur Hubs', 
                    text: message 
                });
            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            }
        }

        // ‚úÖ LOAD ALL CATEGORIES (For Search Screen)
        function loadAllCategories() {
            const allCatList = document.getElementById('all-categories-list');
            if (!allCatList) return;
            allCatList.innerHTML = '';
            
            ALL_CATEGORIES.forEach(cat => {
                const button = document.createElement('button');
                button.className = 'cat-btn';
                button.textContent = cat;
                button.onclick = () => {
                    const mistriListDiv = document.getElementById('mistri-list-full');
                    mistriListDiv.innerHTML = `<h3>${cat} Services</h3>`;
                    const filtered = serviceProviders.filter(p => p && p.category === cat);
                    
                    if (filtered.length === 0) {
                        mistriListDiv.innerHTML += '<p style="color:red; text-align: center;">No services found.</p>';
                        return;
                    }

                    filtered.forEach(provider => {
                        const card = document.createElement('div');
                        card.className = 'profile-card';
                        card.innerHTML = createProfessionalCard(provider);
                        mistriListDiv.appendChild(card);
                    });
                };
                allCatList.appendChild(button);
            });
        }

        // ‚úÖ INITIALIZE APP
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ App Started - No Errors!");
            
            // Form event listener
            const serviceForm = document.getElementById('serviceForm');
            if (serviceForm) {
                serviceForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    registerService();
                });
            }
            
            // Job form event listener
            const jobForm = document.getElementById('jobForm');
            if (jobForm) {
                jobForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    postJob();
                });
            }
            
                        // Load categories for search screen
            loadAllCategories();
            
            // Start Firebase
            startFirebaseListener();
            
            // ‚úÖ YE LINE ADD HO GAYI
            setupCategoryFilters();
        });
            </script>
<script>
    // 1. Firebase Initialization 
    const app = firebase.initializeApp(firebaseConfig); 
    const database = app.database();
    
    // 2. Global References ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
    window.providersRef = database.ref('service_providers');
    window.jobsRef = database.ref('job_listings');
    
    // 3. Authentication ‡§ï‡•ã ‡§∏‡§¨‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ï‡§∞‡•á‡§Ç (‡§Ø‡§π Auth ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§π‡§≤ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à)
    firebase.auth().signInAnonymously()
        .then(() => {
            // 4. Auth ‡§∏‡§´‡§≤ ‡§π‡•ã‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶, Listener ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç (‡§Ø‡§π Load More ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§π‡§≤ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à)
            startFirebaseListener(window.providersRef, window.jobsRef); 
        })
        .catch(error => {
            console.error("Auth error:", error);
        });
        
    // 5. DOMContentLoaded ‡§ï‡•Ä ‡§™‡§∞‡§µ‡§æ‡§π ‡§® ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è ‡§á‡§∏‡•á ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
    loadAllCategories();
    
</script>

<script src="script.js?v=FinalDone"></script> 
</body> 
</html>
