<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fatehpur Hubs - Local Services & Jobs</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="manifest" href="manifest.json?v=3.0">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script type="text/javascript" src="script.js"></script>
    <script type="text/javascript" src="ads.js"></script>
    </head>
<body> 
    
    <div id="app-container">

        <!-- -------------------- LOGOUT AND AUTH SCREEN -------------------- -->
        <div id="registrationScreen" style="display: none;">
            <h2>Fatehpur Hubs: Services & Jobs</h2>
            <div id="loginMsg">‡§ï‡•É‡§™‡§Ø‡§æ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</div>

            <div id="profileInputSection" class="input-group">
                <input type="text" id="userName" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ (Name)" required>
                <input type="text" id="userArea" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§è‡§∞‡§ø‡§Ø‡§æ/‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡§æ (Area)" required style="margin-top: 10px;">
                <input type="number" id="phoneInput" placeholder="10 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞" maxlength="10" required style="margin-top: 10px;">
                <button id="sendOtpBtn" class="main-btn">Send OTP & Sign Up</button>
            </div>

            <div id="otpSection" class="input-group" style="display: none;">
                <input type="number" id="otpInput" placeholder="6 ‡§Ö‡§Ç‡§ï ‡§ï‡§æ OTP" maxlength="6" required>
                <button id="verifyOtpBtn" class="main-btn">Verify OTP & Login</button>
            </div>
            
            <p style="font-size: 0.8rem; color: #777; margin-top: 20px;">Firebase Phone Authentication ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡•§</p>
            <div id="recaptcha-container"></div>
        </div>

        <!-- -------------------- MAIN APPLICATION UI -------------------- -->
        <div id="mainApp" style="display: none;">

            <!-- Header with Logout Button -->
            <header id="app-header">
                <div class="logo">Fatehpur Hubs</div>
                <button class="logout-btn" onclick="window.logOut()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </header>

            <!-- Main Content Screens -->
            <div id="mainAppContent">

                <!-- 1. HOME/MISTRI SCREEN -->
                <div id="home-screen" class="screen active">
                    <!-- TOP Ad Placeholder -->
                    <div class="ad-container">
        <!-- Ad Script 1 -->
        <script type="text/javascript">
            atOptions = { 'key' : '969a80a2e6bea9f00173f36024f32cb2', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
            document.write('<script type="text/javascript" src="//www.highperformanceformat.com/969a80a2e6bea9f00173f36024f32cb2/invoke.js"><\/script>');
        </script>
                    </div>
                    <div id="ad-placeholder-top" class="ad-card" onclick="window.contactForAds()">
                        <p style="font-size: 1.1rem; font-weight: bold; color: #2a5298;">ü§ù ‡§Ö‡§™‡§®‡•á ‡§¨‡§ø‡§ú‡§º‡§®‡•á‡§∏ ‡§ï‡§æ Ad ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ó‡§µ‡§æ‡§è‡§Å! (Top Ad)</p>
                        <p style="font-size: 0.9rem; color: #555;">‡§Ö‡§™‡§®‡•á ‡§ï‡§∏‡•ç‡§ü‡§Æ‡§∞‡•ç‡§∏ ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡•á‡§Ç‡•§</p>
                        <button>Contact for Ads</button>
                    </div>

                    <!-- Search -->
                    <div id="search-container">
                        <input type="text" id="main-search-bar" placeholder="‡§∏‡•á‡§µ‡§æ ‡§Ø‡§æ ‡§è‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç..." onkeyup="searchServices()">
                    </div>

                    <!-- Categories -->
<div id="mistri-categories" class="categories-grid">
    <!-- EXISTING CATEGORIES -->
    <button class="cat-btn" onclick="filterByCategory('Plumber')">Plumber</button>
    <button class="cat-btn" onclick="filterByCategory('Electrician')">Electrician</button>
    <button class="cat-btn" onclick="filterByCategory('Carpenter')">Carpenter</button>
    <button class="cat-btn" onclick="filterByCategory('Mason')">Mason</button>
    <button class="cat-btn" onclick="filterByCategory('Painter')">Painter</button>
    <button class="cat-btn" onclick="filterByCategory('AC Mechanic')">AC Mechanic</button>
    <button class="cat-btn" onclick="filterByCategory('Tiler')">Tiler</button>
    <button class="cat-btn" onclick="filterByCategory('Beautician')">Beautician</button>
    <button class="cat-btn" onclick="filterByCategory('Home Cleaning')">Home Cleaning</button>
    <button class="cat-btn" onclick="filterByCategory('Security Guard')">Security Guard</button>
    <button class="cat-btn" onclick="filterByCategory('Laundry Service')">Laundry Service</button>
    <button class="cat-btn" onclick="filterByCategory('Legal Consultant')">Legal Consultant</button>
    <button class="cat-btn" onclick="filterByCategory('Private Teacher')">Private Teacher</button>
    <button class="cat-btn" onclick="filterByCategory('Computer Repair')">Computer Repair</button>
    <button class="cat-btn" onclick="filterByCategory('Welder')">Welder</button>
    
    <!-- NEW CATEGORIES (‡§ú‡§ø‡§®‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§ü‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Ü ‡§∞‡§π‡•á ‡§•‡•á) -->
    <button class="cat-btn" onclick="filterByCategory('DJ Service')">DJ Service</button>
    <button class="cat-btn" onclick="filterByCategory('Driver')">Driver</button>
    <button class="cat-btn" onclick="filterByCategory('Catering')">Catering</button>
    <button class="cat-btn" onclick="filterByCategory('Event Planner')">Event Planner</button>
    <button class="cat-btn" onclick="filterByCategory('Photographer')">Photographer</button>
    <button class="cat-btn" onclick="filterByCategory('Car Mechanic')">Car Mechanic</button>
</div>

                    

                    <!-- Provider List (Services will be loaded here) -->
                    <div id="mistri-list">
                        <!-- Services will be loaded here -->
                    </div>
                    
                    <!-- -------------------- MIDDLE AD UNIT (300x250) -------------------- -->
                    <div class="ad-container" style="
                        width: 300px; /* 300px width */
                        height: 250px; 
                        margin: 20px auto; 
                        border: 1px solid #ddd;
                        text-align: center;">
                        
                        <!-- Ad Script 2: Your 300x250 Adsterra Code -->
                        <script type="text/javascript">
                            atOptions = {
                                'key' : 'd65603602583bbe6bc3308e8ee8ab792',
                                'format' : 'iframe',
                                'height' : 250,
                                'width' : 300,
                                'params' : {}
                            };
                        </script>
                        <script type="text/javascript" src="//www.highperformanceformat.com/d65603602583bbe6bc3308e8ee8ab792/invoke.js"></script>
                    </div>
                    <!-- -------------------------------------------------------------------- -->

                    <button id="load-more-providers" class="main-btn" style="display:none; margin-top: 15px; margin-bottom: 15px;" onclick="loadCategories(true)">
                        Load More Services
                    </button>

                    
                </div>

                <!-- 2. SERVICE ADD SCREEN -->
                <div id="add-service-screen" class="screen">
                    <div class="form-container">
                        <h3>üîß ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§™‡•ç‡§∞‡•ã‡§µ‡§æ‡§á‡§°‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
                        <form id="serviceForm" onsubmit="return registerService()">
                            <div class="form-field">
                                <label for="providerName">‡§®‡§æ‡§Æ</label>
                                <input type="text" id="providerName" required>
                            </div>
                            <div class="form-field">
                                <label for="providerPhone">‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ (10 ‡§Ö‡§Ç‡§ï)</label>
                                <input type="number" id="providerPhone" maxlength="10" required>
                            </div>
                            <div class="form-field">
                                <label for="serviceCategory">‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</label>
                                <select id="serviceCategory" required>
                                    <option value="">-- ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
                                    <option value="Plumber">‡§™‡•ç‡§≤‡§Æ‡•ç‡§¨‡§∞ (Plumber)</option>
                                    <option value="Electrician">‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä‡§∂‡§ø‡§Ø‡§® (Electrician)</option>
                                    <option value="Carpenter">‡§¨‡§¢‡§º‡§à (Carpenter)</option>
                                    <option value="Mason">‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä (Mason)</option>
                                    <option value="Painter">‡§™‡•á‡§Ç‡§ü‡§∞ (Painter)</option>
                                    <option value="AC Mechanic">AC ‡§Æ‡•à‡§ï‡•á‡§®‡§ø‡§ï</option>
                                    <option value="Tiler">‡§ü‡§æ‡§á‡§≤‡§∞ (Tiler)</option>
                                    <option value="Beautician">‡§¨‡•ç‡§Ø‡•Ç‡§ü‡•Ä‡§∂‡§ø‡§Ø‡§®</option>
                                    <option value="Home Cleaning">‡§π‡•ã‡§Æ ‡§ï‡•ç‡§≤‡•Ä‡§®‡§ø‡§Ç‡§ó</option>
                                    <option value="Security Guard">‡§∏‡§ø‡§ï‡•ç‡§Ø‡•ã‡§∞‡§ø‡§ü‡•Ä ‡§ó‡§æ‡§∞‡•ç‡§°</option>
                                    <option value="Laundry Service">‡§≤‡•â‡§®‡•ç‡§°‡•ç‡§∞‡•Ä ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏</option>
                                    <option value="Legal Consultant">‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä ‡§∏‡§≤‡§æ‡§π‡§ï‡§æ‡§∞</option>
                                    <option value="Private Teacher">‡§™‡•ç‡§∞‡§æ‡§á‡§µ‡•á‡§ü ‡§ü‡•Ä‡§ö‡§∞</option>
                                    <option value="Computer Repair">‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞/‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞</option>
                                    <option value="Welder">‡§µ‡•á‡§≤‡•ç‡§°‡§∞</option>
                                    <!-- NEW CATEGORIES -->
    <option value="DJ Service">DJ ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏</option>
    <option value="Driver">‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option>
    <option value="Catering">‡§ï‡•á‡§ü‡§∞‡§ø‡§Ç‡§ó ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏</option>
    <option value="Event Planner">‡§á‡§µ‡•á‡§Ç‡§ü ‡§™‡•ç‡§≤‡§æ‡§®‡§∞</option>
    <option value="Photographer">‡§´‡•ã‡§ü‡•ã‡§ó‡•ç‡§∞‡§æ‡§´‡§∞</option>
    <option value="Car Mechanic">‡§ï‡§æ‡§∞ ‡§Æ‡•à‡§ï‡•á‡§®‡§ø‡§ï</option>
                                
                                </select>
                            </div>
                            <div class="form-field">
                                <label for="providerArea">‡§è‡§∞‡§ø‡§Ø‡§æ/‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡§æ</label>
                                <input type="text" id="providerArea" required>
                            </div>
                            <div class="form-field">
                                <label for="providerExperience">‡§Ö‡§®‡•Å‡§≠‡§µ (‡§∏‡§æ‡§≤‡•ã‡§Ç ‡§Æ‡•á‡§Ç)</label>
                                <input type="number" id="providerExperience" required min="0">
                            </div>
                            <button type="submit" class="submit-btn">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
                        </form>
                    </div>
                </div>

                <!-- 3. JOB SCREEN (Pending implementation details for loadJobs) -->
                <div id="jobs-screen" class="screen">
                    <div class="form-container">
                        <h3>üíº ‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</h3>
                        <form id="jobForm" onsubmit="event.preventDefault(); return registerJob();">
                            <div class="form-field">
                                <label for="jobTitle">‡§ú‡•â‡§¨ ‡§ü‡§æ‡§á‡§ü‡§≤ (‡§ú‡•à‡§∏‡•á: ‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡•à‡§®)</label>
                                <input type="text" id="jobTitle" required>
                            </div>
                            <div class="form-field">
                                <label for="jobShopName">‡§¶‡•Å‡§ï‡§æ‡§®/‡§ï‡§Ç‡§™‡§®‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                                <input type="text" id="jobShopName" required>
                            </div>
                            <div class="form-field">
                                <label for="jobLocation">‡§ú‡•â‡§¨ ‡§≤‡•ã‡§ï‡•á‡§∂‡§®</label>
                                <input type="text" id="jobLocation" required>
                            </div>
                            <div class="form-field">
                                <label for="jobSalary">‡§∏‡•à‡§≤‡§∞‡•Ä/‡§µ‡•á‡§§‡§®</label>
                                <input type="number" id="jobSalary" required min="1000">
                            </div>
                             <div class="form-field">
                                <label for="jobPhone">‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ (10 ‡§Ö‡§Ç‡§ï)</label>
                                <input type="number" id="jobPhone" maxlength="10" required>
                            </div>
                            <div class="form-field">
                                <label for="jobDescription">‡§ú‡•â‡§¨ ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ (Details)</label>
                                <textarea id="jobDescription" rows="3" required></textarea>
                            </div>
                            <button type="submit" class="submit-btn" style="background-color: #ff9800;">‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                        </form>
                    </div>

                    <h3 style="color: #2a5298;">üåü ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡•å‡§ï‡§∞‡§ø‡§Ø‡§æ‡§Å</h3>
                    <div id="job-list">
                         <p style="text-align:center; color:#555;">‡§ú‡•â‡§¨ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡•ã‡§° ‡§π‡•ã‡§Ç‡§ó‡•Ä‡•§ (Job loading function is currently mock/needs full implementation)</p>
                    </div>
                </div>

                 <!-- 4. SHARE SCREEN -->
                <div id="share-screen" class="screen">
                    <div class="ad-card" style="margin-top: 30px; padding: 40px;">
                        <i class="fas fa-share-alt" style="font-size: 3rem; color: #2a5298; margin-bottom: 15px;"></i>
                        <h3 style="color: #2a5298; margin-bottom: 10px;">Fatehpur Hubs ‡§ï‡•ã ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç!</h3>
                        <p>‡§Ø‡§π ‡§ê‡§™ ‡§´‡§§‡•á‡§π‡§™‡•Å‡§∞ ‡§ï‡•á ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§∏‡•á ‡§Ö‡§™‡§®‡•á ‡§¶‡•ã‡§∏‡•ç‡§§‡•ã‡§Ç ‡§î‡§∞ ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                        <button onclick="window.shareApp()" class="main-btn" style="background-color: #00bcd4;">
                            <i class="fas fa-paper-plane"></i> ‡§Ö‡§≠‡•Ä ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    </div>
                </div>

            </div>
        
                        <div style="position:fixed; bottom:50px; left:0; right:0; z-index:9998; text-align:center; width: 100vw; margin: 0; padding: 0;">
        
        <script type="text/javascript">
            atOptions = { 
                'key' : '969a80a2e6bea9f00173f36024f32cb2', 
                'format' : 'iframe', 
                'height' : 50, 
                'width' : 320, 
                'params' : {} 
            };
            document.write('<script type="text/javascript" src="//www.highperformanceformat.com/969a80a2e6bea9f00173f36024f32cb2/invoke.js"><\/script>');
        </script>
        
    </div>

    <div style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 9999; display: flex; justify-content: space-around; background-color: white; padding: 5px 0; border-top: 1px solid #ddd;">
        
        <div style="text-align: center; color: #2a5298; font-size: 12px; flex: 1; cursor: pointer; padding: 5px 0;" onclick="window.showScreen('home-screen')">
            <i class="fas fa-home" style="font-size: 18px; margin-bottom: 2px;"></i>
            <p style="margin: 0; font-size: 10px;">Home</p>
        </div>
        
        <div style="text-align: center; color: #2a5298; font-size: 12px; flex: 1; cursor: pointer; padding: 5px 0;" onclick="window.showScreen('add-service-screen')">
            <i class="fas fa-handshake" style="font-size: 18px; margin-bottom: 2px;"></i>
            <p style="margin: 0; font-size: 10px;">Service Jodein</p>
        </div>
        
        <div style="text-align: center; color: #2a5298; font-size: 12px; flex: 1; cursor: pointer; padding: 5px 0;" onclick="window.showScreen('jobs-screen')">
            <i class="fas fa-briefcase" style="font-size: 18px; margin-bottom: 2px;"></i>
            <p style="margin: 0; font-size: 10px;">Jobs</p>
        </div>
        
        <div style="text-align: center; color: #2a5298; font-size: 12px; flex: 1; cursor: pointer; padding: 5px 0;" onclick="window.shareApp()">
            <i class="fas fa-share-alt" style="font-size: 18px; margin-bottom: 2px;"></i>
            <p style="margin: 0; font-size: 10px;">Share</p>
        </div>

    </div>


<!-- promo.js ‡§≤‡§ø‡§Ç‡§ï -->
<script src="promo.js"></script>
<script src="reviews.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            if (typeof loadRatingsForAllMistris === 'function') {
                loadRatingsForAllMistris();
            }
        }, 3000);
    });
</script>
            <!-- LOCAL RATING SYSTEM - NO FIREBASE NEEDED -->
<script>
// LOCAL RATING SYSTEM - Works without Firebase
console.log("Local Rating System Started");

// Wait for page to load
setTimeout(function() {
  // Find all mistri/service cards
  var allCards = document.querySelectorAll('.profile-card');
  console.log("Found " + allCards.length + " cards");
  
  // Check if we already have ratings in localStorage
  var allRatings = JSON.parse(localStorage.getItem('fatehpur_ratings')) || {};
  
  allCards.forEach(function(card, index) {
    // Skip if already has rating
    if (card.querySelector('.local-rating-box')) return;
    
    // Get mistri name from card
    var h3 = card.querySelector('h3');
    if (!h3) return;
    
    var mistriName = h3.textContent.trim();
    var mistriPhone = '';
    
    // Try to get phone number from buttons
    var whatsappBtn = card.querySelector('[onclick*="openWhatsApp"]');
    if (whatsappBtn) {
      var onclickText = whatsappBtn.getAttribute('onclick') || '';
      var match = onclickText.match(/openWhatsApp\('([^']+)'\)/);
      if (match) mistriPhone = match[1];
    }
    
    // Create unique ID for this mistri
    var mistriId = (mistriPhone || mistriName).replace(/\D/g, '') || 'mistri_' + index;
    
    // Get this mistri's ratings from localStorage
    var mistriRatings = allRatings[mistriId] || { 
      total: 0, 
      count: 0, 
      name: mistriName,
      reviews: [] 
    };
    
    // Calculate average rating
    var avgRating = mistriRatings.count > 0 ? (mistriRatings.total / mistriRatings.count).toFixed(1) : 0;
    
    // Create stars HTML
    var starsHTML = '';
    var fullStars = Math.floor(avgRating);
    var hasHalf = (avgRating % 1) >= 0.5;
    
    for (var i = 0; i < fullStars; i++) starsHTML += '‚òÖ';
    if (hasHalf) starsHTML += '¬Ω';
    for (var i = starsHTML.length; i < 5; i++) starsHTML += '‚òÜ';
    
    // Create rating HTML
    var ratingHTML = `
    <div class="local-rating-box" style="
      margin: 10px 0;
      padding: 12px;
      background: ${mistriRatings.count > 0 ? '#e8f5e9' : '#fff3e0'};
      border-radius: 8px;
      border-left: 4px solid ${mistriRatings.count > 0 ? '#4CAF50' : '#ff9800'};
    ">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="color: #ff9800; font-size: 16px; font-weight: bold;">
            ${starsHTML} <span style="color: #2a5298;">${avgRating}/5</span>
          </div>
          <div style="font-size: 12px; color: #666; margin-top: 3px;">
            ${mistriRatings.count > 0 ? 
              mistriRatings.count + ' review' + (mistriRatings.count > 1 ? 's' : '') : 
              'No reviews yet'}
          </div>
        </div>
        <button onclick="showLocalRatingForm('${mistriId}', '${mistriName.replace(/'/g, "\\'")}')" 
          style="
            background: ${mistriRatings.count > 0 ? '#2196F3' : '#4CAF50'};
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            font-weight: bold;
          ">
          ${mistriRatings.count > 0 ? 'ADD REVIEW' : 'BE FIRST'}
        </button>
      </div>
      
      ${mistriRatings.reviews.length > 0 ? `
      <div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ddd;">
        <div style="font-size: 11px; color: #666; margin-bottom: 5px;">Recent reviews:</div>
        ${mistriRatings.reviews.slice(0, 2).map(function(review) {
          return `
          <div style="font-size: 12px; margin-bottom: 5px; padding: 5px; background: #f9f9f9; border-radius: 4px;">
            <span style="color: #ff9800;">${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5-review.rating)}</span>
            <span style="color: #666; margin-left: 5px;">${review.comment || 'No comment'}</span>
            <div style="font-size: 10px; color: #999; margin-top: 2px;">- ${review.user || 'Anonymous'}</div>
          </div>
          `;
        }).join('')}
      </div>
      ` : ''}
    </div>`;
    
    // Insert into card
    h3.insertAdjacentHTML('afterend', ratingHTML);
  });
  
  console.log("Ratings added to " + allCards.length + " cards");
}, 2000);

// RATING FORM FUNCTION
window.showLocalRatingForm = function(mistriId, mistriName) {
  // Create form HTML
  var formHTML = `
  <div id="ratingFormOverlay" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 99999;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
  ">
    <div style="
      background: white;
      padding: 25px;
      border-radius: 15px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    ">
      <h3 style="color: #2a5298; text-align: center; margin-bottom: 20px;">
        ‚≠ê Rate ${mistriName}
      </h3>
      
      <!-- Stars -->
      <div style="text-align: center; margin: 20px 0;">
        <div id="localStars" style="font-size: 40px; color: #ccc; cursor: pointer;">
          <span data-rating="1">‚òÜ</span>
          <span data-rating="2">‚òÜ</span>
          <span data-rating="3">‚òÜ</span>
          <span data-rating="4">‚òÜ</span>
          <span data-rating="5">‚òÜ</span>
        </div>
        <div id="localRatingText" style="color: #666; margin-top: 10px; font-size: 14px;">
          Tap stars to rate (1-5)
        </div>
      </div>
      
      <!-- Name -->
      <input type="text" id="localUserName" 
        placeholder="Your name (optional)" 
        style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;">
      
      <!-- Comment -->
      <textarea id="localUserComment" 
        placeholder="Your review (optional)" 
        rows="3"
        style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;"></textarea>
      
      <!-- Buttons -->
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button id="localSubmitBtn" 
          style="flex: 1; background: #4CAF50; color: white; border: none; padding: 14px; border-radius: 8px; font-weight: bold; cursor: pointer;">
          SUBMIT REVIEW
        </button>
        <button onclick="document.getElementById('ratingFormOverlay').remove()" 
          style="background: #f44336; color: white; border: none; padding: 14px 20px; border-radius: 8px; cursor: pointer;">
          CANCEL
        </button>
      </div>
    </div>
  </div>`;
  
  // Add to page
  document.body.insertAdjacentHTML('beforeend', formHTML);
  
  // Star rating logic
  var selectedRating = 0;
  var stars = document.querySelectorAll('#localStars span');
  var ratingText = document.getElementById('localRatingText');
  
  stars.forEach(function(star) {
    star.addEventListener('click', function() {
      selectedRating = parseInt(this.getAttribute('data-rating'));
      
      // Update stars display
      stars.forEach(function(s, index) {
        s.textContent = index < selectedRating ? '‚òÖ' : '‚òÜ';
        s.style.color = index < selectedRating ? '#FFD700' : '#ccc';
      });
      
      // Update text
      var texts = ['Very Poor', 'Poor', 'Good', 'Very Good', 'Excellent'];
      ratingText.innerHTML = selectedRating + '/5 - ' + texts[selectedRating - 1] + ' ‚òÖ';
      ratingText.style.color = '#4CAF50';
    });
  });
  
  // Submit button
  document.getElementById('localSubmitBtn').onclick = function() {
    if (selectedRating === 0) {
      alert('Please select a rating by tapping the stars');
      return;
    }
    
    var userName = document.getElementById('localUserName').value.trim() || 'Anonymous';
    var userComment = document.getElementById('localUserComment').value.trim();
    
    // Get existing ratings
    var allRatings = JSON.parse(localStorage.getItem('fatehpur_ratings')) || {};
    
    // Get or create mistri's rating object
    var mistriRatings = allRatings[mistriId] || { 
      total: 0, 
      count: 0, 
      name: mistriName,
      reviews: [] 
    };
    
    // Add new review
    mistriRatings.total += selectedRating;
    mistriRatings.count++;
    mistriRatings.reviews.unshift({
      rating: selectedRating,
      user: userName,
      comment: userComment,
      date: new Date().toLocaleDateString('hi-IN'),
      time: new Date().toLocaleTimeString('hi-IN', { hour: '2-digit', minute: '2-digit' })
    });
    
    // Keep only last 10 reviews
    if (mistriRatings.reviews.length > 10) {
      mistriRatings.reviews = mistriRatings.reviews.slice(0, 10);
    }
    
    // Save back to localStorage
    allRatings[mistriId] = mistriRatings;
    localStorage.setItem('fatehpur_ratings', JSON.stringify(allRatings));
    
    // Show success message
    alert('‚úÖ Thank you! Your ' + selectedRating + '-star review has been saved!\n\nIt will be visible to all app users.');
    
    // Remove form
    document.getElementById('ratingFormOverlay').remove();
    
    // Refresh ratings after 1 second
    setTimeout(function() {
      location.reload();
    }, 1000);
  };
};

// Auto-refresh ratings when new cards load
setInterval(function() {
  var newCards = document.querySelectorAll('.profile-card:not(:has(.local-rating-box))');
  if (newCards.length > 0) {
    console.log("New cards found, adding ratings...");
    // Trigger ratings update by reloading
    var event = new Event('ratingsUpdate');
    window.dispatchEvent(event);
  }
}, 3000);

console.log("‚úÖ Local Rating System Ready!");
</script>
</body>
        </html>
            
